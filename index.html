<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MikroTik Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* GLOB√ÅLNY Z√ÅKAZ V≈†ETK√ùCH ANIM√ÅCI√ç A HOVER EFEKTOV NA KART√ÅCH */
        * {
            --tw-scale-x: 1 !important;
            --tw-scale-y: 1 !important;
        }
        
        /* Zak√°za≈• v≈°etky mo≈æn√© transform efekty - ale NIE na tlaƒçidl√°ch */
        .card:not(.btn),
        .card *:not(.btn),
        .p-6:not(.btn),
        .rounded-lg:not(.btn),
        [class*="card"]:not(.btn) {
            transform: none !important;
            scale: 1 !important;
            transition: none !important;
            animation: none !important;
        }
        
        /* Zru≈°i≈• v≈°etky hover efekty - ale NIE na tlaƒçidl√°ch */
        .card:hover:not(.btn),
        .card:focus:not(.btn),
        .card:active:not(.btn),
        .card *:hover:not(.btn),
        .card *:focus:not(.btn),
        .card *:active:not(.btn) {
            transform: none !important;
            scale: 1 !important;
            transition: none !important;
            animation: none !important;
        }
        
        :root { 
            --main-bg: #111827; --card-bg: #1f2937; --border-color: #374151; 
            --text-color: #d1d5db; --accent-color: #38bdf8; --accent-color-hover: #0ea5e9;
        }
        body { background-color: var(--main-bg); color: var(--text-color); font-family: 'Inter', sans-serif; }
        .card { background-color: var(--card-bg); border: 1px solid var(--border-color); transition: all 0.3s ease; }
        /* √öPLNE zak√°zan√© hover efekty na kart√°ch - ≈æiadne anim√°cie */
        .card {
            transition: none !important;
        }
        
        .card:hover {
            box-shadow: 0 0 15px rgba(56, 189, 248, 0.1) !important;
            border-color: rgba(56, 189, 248, 0.3) !important;
            transform: none !important;
            transition: none !important;
            animation: none !important;
        }
        
        /* √öpln√Ω z√°kaz scale/transform anim√°ci√≠ na kart√°ch (NIE na tlaƒçidl√°ch) */
        .card:not(.btn),
        .card *:not(.btn),
        .card:hover:not(.btn),
        .card:focus:not(.btn),
        .card:active:not(.btn) {
            transform: none !important;
            scale: none !important;
            animation: none !important;
            transition: none !important;
        }
        
        /* Ale POVOLEN√â hover efekty na tlaƒçidl√°ch v kart√°ch */
        .card .btn {
            font-weight: 600 !important;
            letter-spacing: 0.025em !important;
            /* Len jednoduch√© hover efekty bez fancy shadow */
        }
        
        .card .btn:hover {
            /* Anim√°cia zo starej verzie - presne ako bola */
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }
        
        /* Disabled stav pre tlaƒçidl√° */
        .card .btn:disabled {
            opacity: 0.6 !important;
            cursor: not-allowed !important;
        }
        
        /* GLOB√ÅLNE pravidl√° pre v≈°etky tlaƒçidl√° - ako v starej verzii */
        .btn { 
            transition: all 0.2s ease-in-out; 
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }
        
        /* Zak√°za≈• hover efekty poƒças refresh oper√°ci√≠ */
        .card.refreshing:hover { box-shadow: none !important; border-color: var(--border-color) !important; transform: none !important; }
        body.refreshing .card:hover { box-shadow: none !important; border-color: var(--border-color) !important; transform: none !important; }
        
        /* Zak√°za≈• transitions len na kart√°ch (NIE na tlaƒçidl√°ch) poƒças refresh */
        body.refreshing .card:not(.btn) {
            transition: none !important;
            animation: none !important;
        }
        
        /* Zak√°za≈• hover anim√°cie pre tlaƒçidl√° poƒças refresh oper√°ci√≠ */
        body.refreshing .btn:hover {
            transform: none !important;
            box-shadow: none !important;
            transition-duration: 0s !important;
        }
        
        /* Z√°kladn√© pravidl√° pre tlaƒçidl√° */
        .btn { transition: all 0.2s ease-in-out; }
        .btn-primary { background-color: var(--accent-color); color: #ffffff; }
        .btn-primary:hover { background-color: var(--accent-color-hover); }
        
        /* Hover anim√°cie pre hlavn√© tlaƒçidl√° */
        #addDeviceBtn:hover, #backupAllBtn:hover, #stopAllBackupsBtn:hover, 
        #refreshAllSnmpBtn:hover, #snmpStatusBtn:hover, #monitoringBtn:hover, 
        #viewBackupsBtn:hover, #settingsBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }
        
        /* Pridan√©: Line clamp pre konzistentn√© zobrazenie n√°zvov zariaden√≠ */
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        /* Vlastn√° veƒækos≈• p√≠sma pre tlaƒçidl√° zariaden√≠ - medzi xs a sm */
        .device-btn-text {
            font-size: 0.8125rem !important; /* 13px - medzi text-xs (12px) a text-sm (14px) */
        }
        .device-btn-icon {
            font-size: 0.8125rem !important; /* 13px - rovnak√° veƒækos≈• pre ikony */
        }
        
        /* Anim√°cie pre svetl√∫ t√©mu */
        body.light-theme .btn:hover {
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }
        
        
        /* Zak√°za≈• hover anim√°cie pre tlaƒçidl√° poƒças refresh oper√°ci√≠ - svetl√° t√©ma */
        body.light-theme.refreshing .btn:hover {
            transform: none !important;
            box-shadow: none !important;
        }
        
        /* Zak√°za≈• hover efekty na kart√°ch poƒças refresh oper√°ci√≠ - svetl√° t√©ma */
        body.light-theme.refreshing .card:hover {
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06) !important;
            border-color: var(--border-color) !important;
        }
        
        /* Zak√°za≈• v≈°etky transitions v svetlej t√©me poƒças refresh */
        body.light-theme.refreshing .card,
        body.light-theme.refreshing .card *,
        body.light-theme.refreshing .btn,
        body.light-theme.refreshing .btn * {
            transition: none !important;
            animation: none !important;
        }
        
        /* Glob√°lne potlaƒçenie anim√°ci√≠ v svetlej t√©me poƒças refresh */
        body.light-theme.refreshing *,
        body.light-theme.refreshing *:before,
        body.light-theme.refreshing *:after {
            animation-duration: 0s !important;
            animation-delay: 0s !important;
            transition-duration: 0s !important;
            transition-delay: 0s !important;
            transform: none !important;
        }
        
        /* Extra potlaƒçenie pre svetl√∫ t√©mu */
        body.light-theme.refreshing .card,
        body.light-theme.refreshing .card *,
        body.light-theme.refreshing .card:hover,
        body.light-theme.refreshing .card *:hover {
            transition: none !important;
            animation: none !important;
            transform: none !important;
            opacity: 1 !important;
        }
        .status-online { color: #4ade80; }
        .status-offline { color: #f87171; }
        .status-unknown { color: #9ca3af; }
        
        /* Stavy zariaden√≠ v svetlej t√©me - menej saturovan√© farby */
        body.light-theme .status-online {
            color: #16a34a !important; /* Tmav≈°ia, menej saturovan√° zelen√° */
        }
        
        body.light-theme .status-offline {
            color: #dc2626 !important; /* Tmav≈°ia, menej saturovan√° ƒçerven√° */
        }
        
        body.light-theme .status-unknown {
            color: #6b7280 !important; /* Tmav≈°ia siv√° pre lep≈°√≠ kontrast */
        }
        .log-info { border-left-color: #38bdf8; }
        .log-success { border-left-color: #4ade80; }
        .log-warning { border-left-color: #facc15; }
        .log-error { border-left-color: #f87171; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .spinning { animation: spin 1s linear infinite; }
        .modal-content { animation: modal-fade-in 0.3s ease-out; }
        @keyframes modal-fade-in { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        .modal-content::-webkit-scrollbar { width: 8px; }
        .modal-content::-webkit-scrollbar-track { background: var(--card-bg); }
        .modal-content::-webkit-scrollbar-thumb { background-color: var(--accent-color); border-radius: 10px; border: 2px solid var(--card-bg); }
        
        /* Posuvn√≠k pre logy aktiv√≠t - tmav√© t√©ma */
        #logsContainer::-webkit-scrollbar { width: 8px; }
        #logsContainer::-webkit-scrollbar-track { background: #1f2937; border-radius: 4px; }
        #logsContainer::-webkit-scrollbar-thumb { background-color: #4b5563; border-radius: 4px; border: 1px solid #374151; }
        #logsContainer::-webkit-scrollbar-thumb:hover { background-color: #6b7280; }
        
        /* ≈†t√Ωly pre log filtre */
        .filter-level-btn, .filter-level-btn-mobile { 
            transition: all 0.2s ease; 
            border: 1px solid transparent;
        }
        .filter-level-btn.active, .filter-level-btn-mobile.active { 
            border-color: #38bdf8; 
            box-shadow: 0 0 5px rgba(56, 189, 248, 0.3);
        }
        .log-entry { 
            transition: opacity 0.2s ease; 
        }
        .log-entry.filtered { 
            display: none; 
        }
        
        .mr-84 { margin-right: 0; }
        .activity-log { width: 100%; }
        .activity-right { right: auto; }
        .main-content-wrapper { display: flex; gap: 2rem; align-items: flex-start; }
        .left-content { flex: 1; }
        .right-sidebar { width: 24rem; min-width: 20rem; }
        @media (max-width: 1400px) {
            .right-sidebar { width: 20rem; min-width: 18rem; }
        }
        @media (max-width: 1200px) {
            .right-sidebar { width: 18rem; min-width: 16rem; }
        }
        @media (max-width: 1024px) {
            .main-content-wrapper { flex-direction: column; }
            .right-sidebar { display: none !important; }
            #mobileLogs { display: block !important; }
            #userStatus { text-align: right !important; }
        }
        @media (min-width: 1025px) {
            #mobileLogs { display: none !important; }
        }
        header h1 {
            margin-left: -2rem;
            text-align: center;
        }
        @media (max-width: 768px) {
            header h1 {
                margin-left: 0;
            }
        }
        
        /* Tlaƒçidlo prep√≠naƒça t√©my */
        .theme-toggle {
            padding: 0.5rem;
            border: 1px solid var(--border-color);
            background-color: var(--card-bg);
            color: var(--text-color);
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .theme-toggle:hover {
            border-color: var(--accent-color);
            background-color: rgba(56, 189, 248, 0.1);
        }
        
        /* Responsive nastavenia pre theme toggle */
        @media (max-width: 768px) {
            .theme-toggle {
                width: 36px;
                height: 36px;
                font-size: 14px;
            }
        }
        
        /* Header responsive nastavenia */
        @media (max-width: 768px) {
            .flex.justify-between.items-center h1 {
                font-size: 1.125rem;
            }
            .flex.justify-between.items-center h1 .fas {
                font-size: 1rem;
            }
            .hidden.sm\\:inline {
                display: none !important;
            }
        }
        
        /* Action buttons responsive nastavenia */
        @media (max-width: 640px) {
            .flex.flex-wrap.gap-3 {
                gap: 0.5rem;
            }
            .flex.flex-wrap.gap-3 button {
                padding: 0.375rem 0.75rem;
                font-size: 0.75rem;
            }
            .flex.flex-wrap.gap-3 button i {
                font-size: 0.75rem;
            }
        }

        /* Activity log resize capability */
        .right-sidebar .card.resize-y {
            resize: vertical;
            overflow: hidden;
        }
        
        .right-sidebar .card.resize-y::-webkit-resizer {
            background: var(--accent-color);
            border-radius: 0 0 8px 0;
        }

        /* Svetl√° t√©ma */
        body.light-theme {
            --main-bg: #f1f5f9;
            --card-bg: #f8fafc;
            --border-color: #cbd5e1;
            --text-color: #334155;
            --accent-color: #0369a1;
            --accent-color-hover: #0284c7;
        }
        
        /* Texty v svetlej t√©me */
        body.light-theme h1,
        body.light-theme h2,
        body.light-theme h3,
        body.light-theme .text-white {
            color: var(--text-color) !important;
        }
        
        body.light-theme .text-gray-400,
        body.light-theme .text-gray-300 {
            color: #64748b !important;
        }
        
        body.light-theme .text-gray-200 {
            color: var(--text-color) !important;
        }
        
        body.light-theme .text-sky-400,
        body.light-theme .text-sky-500 {
            color: var(--accent-color) !important;
        }
        
        /* Input fields a select v svetlej t√©me */
        body.light-theme input,
        body.light-theme select,
        body.light-theme textarea {
            background-color: #ffffff !important;
            border-color: var(--border-color) !important;
            color: var(--text-color) !important;
        }
        
        body.light-theme input:focus,
        body.light-theme select:focus,
        body.light-theme textarea:focus {
            border-color: var(--accent-color) !important;
            box-shadow: 0 0 0 3px rgba(3, 105, 161, 0.1) !important;
        }
        
        /* Log entries v svetlej t√©me */
        body.light-theme .log-entry {
            background-color: #ffffff !important;
            color: var(--text-color) !important;
        }
        
        body.light-theme .log-entry strong {
            color: #64748b !important;
        }
        
        /* Filter buttons v svetlej t√©me */
        body.light-theme .filter-level-btn,
        body.light-theme .filter-level-btn-mobile {
            background-color: #e2e8f0 !important;
            color: var(--text-color) !important;
            border-color: var(--border-color) !important;
        }
        
        body.light-theme .filter-level-btn:hover,
        body.light-theme .filter-level-btn-mobile:hover {
            background-color: #cbd5e1 !important;
        }
        
        body.light-theme .filter-level-btn.active,
        body.light-theme .filter-level-btn-mobile.active {
            background-color: var(--accent-color) !important;
            color: #ffffff !important;
        }
        
        /* Tlaƒçidl√° v svetlej t√©me */
        body.light-theme .btn {
            color: #ffffff !important;
        }
        
        body.light-theme .btn-primary {
            background-color: var(--accent-color) !important;
            color: #ffffff !important;
        }
        
        body.light-theme .btn-primary:hover {
            background-color: var(--accent-color-hover) !important;
        }
        
        body.light-theme .bg-green-600 {
            background-color: #16a34a !important;
            color: #ffffff !important;
        }
        
        body.light-theme .bg-green-600:hover,
        body.light-theme .hover\:bg-green-700:hover {
            background-color: #15803d !important;
        }
        
        body.light-theme .bg-blue-600 {
            background-color: #2563eb !important;
            color: #ffffff !important;
        }
        
        body.light-theme .bg-blue-600:hover,
        body.light-theme .hover\:bg-blue-700:hover {
            background-color: #1d4ed8 !important;
        }
        
        body.light-theme .bg-red-600 {
            background-color: #dc2626 !important;
            color: #ffffff !important;
        }
        
        body.light-theme .bg-red-600:hover,
        body.light-theme .hover\:bg-red-700:hover {
            background-color: #b91c1c !important;
        }
        
        body.light-theme .bg-purple-600 {
            background-color: #9333ea !important;
            color: #ffffff !important;
        }
        
        body.light-theme .bg-purple-600:hover,
        body.light-theme .hover\:bg-purple-700:hover {
            background-color: #7c3aed !important;
        }
        
        body.light-theme .bg-orange-600 {
            background-color: #ea580c !important;
            color: #ffffff !important;
        }
        
        body.light-theme .bg-orange-600:hover,
        body.light-theme .hover\:bg-orange-700:hover {
            background-color: #c2410c !important;
        }
        
        body.light-theme .bg-gray-600 {
            background-color: #4b5563 !important;
            color: #ffffff !important;
        }
        
        body.light-theme .bg-gray-600:hover,
        body.light-theme .hover\:bg-gray-700:hover {
            background-color: #374151 !important;
        }
        
        body.light-theme .bg-yellow-500 {
            background-color: #eab308 !important;
            color: #ffffff !important;
        }
        
        body.light-theme .bg-yellow-500:hover,
        body.light-theme .hover\:bg-yellow-600:hover {
            background-color: #ca8a04 !important;
        }
        
        body.light-theme .bg-teal-600 {
            background-color: #0d9488 !important;
            color: #ffffff !important;
        }
        
        body.light-theme .bg-teal-600:hover,
        body.light-theme .hover\:bg-teal-700:hover {
            background-color: #0f766e !important;
        }
        
        body.light-theme .theme-toggle {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        body.light-theme #logsContainer::-webkit-scrollbar-track {
            background: #f8fafc;
        }
        
        body.light-theme #logsContainer::-webkit-scrollbar-thumb {
            background-color: #cbd5e1;
            border: 1px solid #e2e8f0;
        }
        
        body.light-theme #logsContainer::-webkit-scrollbar-thumb:hover {
            background-color: #94a3b8;
        }
        
        body.light-theme .modal-content::-webkit-scrollbar-track {
            background: var(--card-bg);
        }
        
        body.light-theme .modal-content::-webkit-scrollbar-thumb {
            background-color: var(--accent-color);
            border: 2px solid var(--card-bg);
        }
        
        /* Mod√°lne okn√° v svetlej t√©me */
        body.light-theme .modal-content,
        body.light-theme #deviceModal .card,
        body.light-theme #settingsModal .card,
        body.light-theme #changePasswordModal .card,
        body.light-theme #manage2faModal .card,
        body.light-theme #confirmPasswordModal .card,
        body.light-theme #backupCodesModal .card,
        body.light-theme #snmpStatusModal .card {
            background-color: #ffffff !important;
            border-color: var(--border-color) !important;
        }
        
        /* 2FA mod√°ly - svetl√Ω re≈æim texty */
        body.light-theme #manage2faModal h2,
        body.light-theme #manage2faModal h3,
        body.light-theme #confirmPasswordModal h2,
        body.light-theme #backupCodesModal h2 {
            color: var(--text-color) !important;
        }
        
        body.light-theme #manage2faModal p,
        body.light-theme #manage2faModal span,
        body.light-theme #confirmPasswordModal p,
        body.light-theme #backupCodesModal p {
            color: var(--text-color) !important;
        }
        
        body.light-theme #manage2faModal .text-gray-400,
        body.light-theme #manage2faModal .text-gray-300,
        body.light-theme #confirmPasswordModal .text-gray-400 {
            color: #6b7280 !important;
        }
        
        body.light-theme #manage2faModal .bg-gray-800 {
            background-color: #f3f4f6 !important;
            border: 1px solid #d1d5db !important;
        }
        
        body.light-theme #confirmPasswordModal input,
        body.light-theme #backupCodesModal input {
            background-color: #f9fafb !important;
            border-color: #d1d5db !important;
            color: var(--text-color) !important;
        }
        
        body.light-theme #backupCodesModal .backup-code {
            background-color: #f9fafb !important;
            border-color: #d1d5db !important;
            color: var(--text-color) !important;
        }
        
        /* Labels v svetlej t√©me */
        body.light-theme label {
            color: var(--text-color) !important;
        }
        
        /* Sekƒçn√© nadpisy v svetlej t√©me */
        body.light-theme h3.text-sky-400 {
            color: var(--accent-color) !important;
            border-bottom-color: var(--border-color) !important;
        }
        
        /* Mal√© texty a pomocn√© texty v svetlej t√©me */
        body.light-theme small.text-gray-400 {
            color: #64748b !important;
        }
        
        /* Hranice v svetlej t√©me */
        body.light-theme .border-gray-600,
        body.light-theme .border-gray-700 {
            border-color: var(--border-color) !important;
        }
        
        /* Tlaƒçidl√° X v mod√°lnych okn√°ch - tmav√° t√©ma (z√°kladn√°) */
        #closeSnmpStatusBtn.btn.bg-gray-600,
        #refreshSnmpStatusBtn.btn.bg-gray-600,
        #closeSettingsBtn.btn.bg-gray-600 {
            background-color: #4b5563 !important;
            color: #ffffff !important;
            border: 1px solid #6b7280 !important;
        }
        
        #closeSnmpStatusBtn.btn.bg-gray-600:hover,
        #refreshSnmpStatusBtn.btn.bg-gray-600:hover,
        #closeSettingsBtn.btn.bg-gray-600:hover {
            background-color: #374151 !important;
            color: #ffffff !important;
        }
        
        /* Tlaƒçidl√° X v mod√°lnych okn√°ch - svetl√° t√©ma */
        body.light-theme #closeSnmpStatusBtn.btn.bg-gray-600,
        body.light-theme #refreshSnmpStatusBtn.btn.bg-gray-600 {
            background-color: #e2e8f0 !important;
            color: var(--text-color) !important;
            border: 1px solid var(--border-color) !important;
        }
        
        body.light-theme #closeSnmpStatusBtn.btn.bg-gray-600:hover,
        body.light-theme #refreshSnmpStatusBtn.btn.bg-gray-600:hover {
            background-color: #dc2626 !important;
            color: #ffffff !important;
        }
        
        /* Password Toggle Styles - ONLY for Password Tab */
        #tabPasswordContent .password-input-container {
            position: relative;
        }
        
        #tabPasswordContent .password-toggle {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: #9ca3af;
            font-size: 16px;
            z-index: 10;
            transition: color 0.2s ease;
        }
        
        #tabPasswordContent .password-toggle:hover {
            color: #60a5fa;
        }
        
        body.light-theme #tabPasswordContent .password-toggle {
            color: #6b7280;
        }
        
        body.light-theme #tabPasswordContent .password-toggle:hover {
            color: #3b82f6;
        }
        
        /* Account Management Tabs */
        .account-tab {
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .account-tab.active {
            color: #38bdf8 !important;
            border-color: #38bdf8 !important;
        }
        
        .tab-content {
            display: block;
        }
        
        .tab-content.hidden {
            display: none;
        }
        
        body.light-theme .account-tab {
            color: #64748b !important;
        }
        
        body.light-theme .account-tab.active {
            color: #0ea5e9 !important;
            border-color: #0ea5e9 !important;
        }
        
        body.light-theme .account-tab:hover {
            color: #0ea5e9 !important;
        }
        
        body.light-theme #closeSettingsBtn.btn.bg-gray-600 {
            background-color: #e2e8f0 !important;
            color: var(--text-color) !important;
            border: 1px solid var(--border-color) !important;
        }
        
        body.light-theme #closeSettingsBtn.btn.bg-gray-600:hover {
            background-color: #dc2626 !important;
            color: #ffffff !important;
        }
        
        /* Nastavenia tlaƒçidlo - svetl√° t√©ma */
        body.light-theme #settingsBtn.bg-gray-600 {
            background-color: #64748b !important;
            color: #ffffff !important;
        }
        
        body.light-theme #settingsBtn.bg-gray-600:hover {
            background-color: #475569 !important;
        }
        
        /* Tlaƒçidlo Zru≈°i≈• v mod√°lnych okn√°ch - svetl√° t√©ma */
        body.light-theme #cancelDeviceBtn,
        body.light-theme #cancelSettingsBtn,
        body.light-theme #cancelPasswordChangeBtn,
        body.light-theme #cancelUsernameChangeBtn,
        body.light-theme #cancelAccountManageBtn {
            background-color: #9ca3af !important;
            color: #ffffff !important;
        }
        
        body.light-theme #cancelDeviceBtn:hover,
        body.light-theme #cancelSettingsBtn:hover,
        body.light-theme #cancelPasswordChangeBtn:hover,
        body.light-theme #cancelUsernameChangeBtn:hover,
        body.light-theme #cancelAccountManageBtn:hover {
            background-color: #6b7280 !important;
        }
        
        /* SNMP modal obsah v svetlej t√©me */
        body.light-theme #snmpStatusContent,
        body.light-theme #snmpStatusContent div,
        body.light-theme #snmpStatusContent span {
            background-color: transparent !important;
            color: var(--text-color) !important;
        }
        
        /* SNMP tabulky v svetlej t√©me */
        body.light-theme table,
        body.light-theme thead,
        body.light-theme tbody,
        body.light-theme tr,
        body.light-theme th,
        body.light-theme td {
            background-color: #ffffff !important;
            color: var(--text-color) !important;
            border-color: var(--border-color) !important;
        }
        
        body.light-theme th {
            background-color: #f1f5f9 !important;
            font-weight: 600 !important;
        }
        
        body.light-theme tr:nth-child(even) td {
            background-color: #f8fafc !important;
        }
        
        body.light-theme tr:hover td {
            background-color: #e2e8f0 !important;
        }
        
        /* V≈°etky elementy v SNMP mod√°li - svetl√° t√©ma */
        body.light-theme #snmpStatusModal * {
            color: var(--text-color) !important;
        }
        
        body.light-theme #snmpStatusModal .bg-gray-800,
        body.light-theme #snmpStatusModal .bg-gray-700,
        body.light-theme #snmpStatusModal .bg-gray-600 {
            background-color: #ffffff !important;
        }

        /* Debug Panel Styles */
        .debug-panel {
            position: fixed;
            top: 10px;
            right: 10px;
            width: 400px;
            max-height: 60vh;
            background: rgba(31, 41, 55, 0.95);
            border: 1px solid #4b5563;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: none;
            flex-direction: column;
        }
        
        .debug-panel.visible {
            display: flex;
        }
        
        .debug-panel-header {
            padding: 12px 16px;
            border-bottom: 1px solid #4b5563;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(55, 65, 81, 0.8);
            border-radius: 8px 8px 0 0;
        }
        
        .debug-panel-title {
            font-size: 14px;
            font-weight: 600;
            color: #f3f4f6;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .debug-panel-controls {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .debug-panel-btn {
            background: transparent;
            border: 1px solid #6b7280;
            color: #d1d5db;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .debug-panel-btn:hover {
            background: rgba(75, 85, 99, 0.5);
            border-color: #9ca3af;
            color: #ffffff;
        }
        
        .debug-panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 12px;
            background: rgba(17, 24, 39, 0.9);
            border-radius: 0 0 8px 8px;
        }
        
        .debug-log-entry {
            margin-bottom: 8px;
            padding: 6px 8px;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 12px;
            line-height: 1.4;
            border-left: 3px solid #6b7280;
            background: rgba(31, 41, 55, 0.6);
            word-break: break-word;
        }
        
        .debug-log-entry.debug-chart_operations {
            border-left-color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
        }
        
        .debug-log-entry.debug-api_calls {
            border-left-color: #10b981;
            background: rgba(16, 185, 129, 0.1);
        }
        
        .debug-log-entry.debug-websocket_frontend {
            border-left-color: #f59e0b;
            background: rgba(245, 158, 11, 0.1);
        }
        
        .debug-log-entry.debug-device_operations {
            border-left-color: #8b5cf6;
            background: rgba(139, 92, 246, 0.1);
        }
        
        .debug-log-entry .debug-timestamp {
            color: #9ca3af;
            font-size: 11px;
            margin-right: 8px;
        }
        
        .debug-log-entry .debug-type {
            color: #60a5fa;
            font-weight: 600;
            margin-right: 8px;
        }
        
        .debug-log-entry .debug-message {
            color: #e5e7eb;
        }
        
        .debug-log-entry .debug-args {
            color: #d1d5db;
            font-style: italic;
            margin-top: 4px;
            padding-left: 16px;
            border-left: 2px solid #4b5563;
        }
        
        /* Light theme debug panel */
        body.light-theme .debug-panel {
            background: rgba(255, 255, 255, 0.95);
            border-color: #d1d5db;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        
        body.light-theme .debug-panel-header {
            background: rgba(248, 250, 252, 0.9);
            border-bottom-color: #d1d5db;
        }
        
        body.light-theme .debug-panel-title {
            color: #374151;
        }
        
        body.light-theme .debug-panel-btn {
            border-color: #9ca3af;
            color: #6b7280;
        }
        
        body.light-theme .debug-panel-btn:hover {
            background: rgba(229, 231, 235, 0.5);
            border-color: #6b7280;
            color: #374151;
        }
        
        body.light-theme .debug-panel-content {
            background: rgba(249, 250, 251, 0.9);
        }
        
        body.light-theme .debug-log-entry {
            background: rgba(255, 255, 255, 0.7);
            border-left-color: #9ca3af;
        }
        
        body.light-theme .debug-log-entry.debug-chart_operations {
            border-left-color: #3b82f6;
            background: rgba(59, 130, 246, 0.05);
        }
        
        body.light-theme .debug-log-entry.debug-api_calls {
            border-left-color: #10b981;
            background: rgba(16, 185, 129, 0.05);
        }
        
        body.light-theme .debug-log-entry.debug-websocket_frontend {
            border-left-color: #f59e0b;
            background: rgba(245, 158, 11, 0.05);
        }
        
        body.light-theme .debug-log-entry.debug-device_operations {
            border-left-color: #8b5cf6;
            background: rgba(139, 92, 246, 0.05);
        }
        
        body.light-theme .debug-log-entry .debug-timestamp {
            color: #6b7280;
        }
        
        body.light-theme .debug-log-entry .debug-type {
            color: #2563eb;
        }
        
        body.light-theme .debug-log-entry .debug-message {
            color: #374151;
        }
        
        body.light-theme .debug-log-entry .debug-args {
            color: #6b7280;
            border-left-color: #d1d5db;
        }
        
        /* Mobile responsive debug panel */
        @media (max-width: 768px) {
            .debug-panel {
                position: fixed;
                top: 10px;
                left: 10px;
                right: 10px;
                width: auto;
                max-height: 50vh;
            }
            
            .debug-panel-header {
                padding: 8px 12px;
            }
            
            .debug-panel-title {
                font-size: 13px;
            }
            
            .debug-panel-btn {
                padding: 3px 6px;
                font-size: 11px;
            }
            
            .debug-panel-content {
                padding: 8px;
            }
            
            .debug-log-entry {
                margin-bottom: 6px;
                padding: 4px 6px;
                font-size: 11px;
            }
            
            .debug-log-entry .debug-timestamp,
            .debug-log-entry .debug-type {
                font-size: 10px;
            }
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div id="app" class="w-full max-w-none mx-auto relative" style="max-width: 1600px;">
        <!-- Header with user info -->
        <div class="flex justify-between items-center mb-6">
            <div class="flex items-center gap-4">
                <h1 class="text-xl font-bold text-white flex items-center">
                    <i class="fas fa-network-wired text-sky-400 mr-2"></i>
                    MikroTik Manager
                </h1>
                <span class="text-gray-400 text-sm hidden sm:inline">Spr√°va, z√°lohovanie a monitoring va≈°ich zariaden√≠</span>
            </div>
            <div class="flex items-center gap-4">
                <button class="theme-toggle" id="themeToggleBtn" title="Prepn√∫≈• t√©mu">
                    <i class="fas fa-sun" id="theme-icon"></i>
                </button>
                <div id="userStatus" class="flex items-center gap-2">
                    <!-- T√°to ƒças≈• sa napln√≠ dynamicky cez JavaScript -->
                </div>
            </div>
        </div>

        <div class="main-content-wrapper">
            <div class="left-content">
                <!-- Action buttons -->
                <div class="card p-4 rounded-lg mb-6">
                    <div class="flex flex-wrap gap-3 items-center justify-start">
                        <button id="addDeviceBtn" class="btn bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 text-sm">
                            <i class="fas fa-plus"></i> Prida≈• zariadenie
                        </button>
                        <button id="backupAllBtn" class="btn bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 text-sm">
                            <i class="fas fa-save"></i> Z√°lohova≈• v≈°etky
                        </button>
                        <button id="stopAllBackupsBtn" class="btn bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 text-sm hidden">
                            <i class="fas fa-stop"></i> Zastavi≈• z√°lohy
                        </button>
                        <button id="refreshAllSnmpBtn" class="btn bg-teal-600 hover:bg-teal-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 text-sm">
                            <i class="fas fa-sync"></i> Refresh SNMP
                        </button>
                        <button id="snmpStatusBtn" class="btn bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 text-sm">
                            <i class="fas fa-info-circle"></i> SNMP Stav
                        </button>
                        <button id="monitoringBtn" class="btn bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 text-sm">
                            <i class="fas fa-chart-line"></i> Monitoring
                        </button>
                        <button id="viewBackupsBtn" class="btn bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 text-sm" onclick="window.location.href='/backups'">
                            <i class="fas fa-archive"></i> Z√°lohy
                        </button>
                        <button id="settingsBtn" class="btn bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 text-sm">
                            <i class="fas fa-cog"></i> Nastavenia
                        </button>
                    </div>
                </div>

                <div id="devicesGrid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6 mb-8"></div>
            </div>

            <div class="right-sidebar lg:block hidden">
                <!-- Activity log - integrovan√Ω do layoutu -->
                <div class="card p-4 rounded-lg flex flex-col sticky top-4 resize-y min-h-96" style="max-height: calc(100vh - 80px); height: calc(100vh - 160px);">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-bold text-white">üìã Aktivita</h2>
                        <div class="flex gap-1">
                            <button id="refreshLogsBtn" class="btn bg-blue-600 hover:bg-blue-700 text-white font-bold py-1 px-2 rounded text-xs flex items-center gap-1">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                            <button id="exportLogsBtn" class="btn bg-green-600 hover:bg-green-700 text-white font-bold py-1 px-2 rounded text-xs flex items-center gap-1">
                                <i class="fas fa-download"></i>
                            </button>
                            <button id="logsFilterBtn" class="btn bg-purple-600 hover:bg-purple-700 text-white font-bold py-1 px-2 rounded text-xs flex items-center gap-1">
                                <i class="fas fa-filter"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Filtre pre logy -->
                    <div id="logsFilters" class="mb-3 space-y-2 hidden">
                        <div class="grid grid-cols-2 gap-2">
                            <select id="deviceFilter" class="p-1 rounded bg-gray-800 border border-gray-600 text-xs">
                                <option value="">V≈°etky zariadenia</option>
                            </select>
                            <select id="typeFilter" class="p-1 rounded bg-gray-800 border border-gray-600 text-xs">
                                <option value="">V≈°etky typy</option>
                                <option value="backup">Z√°lohovanie</option>
                                <option value="notification">Notifik√°cie</option>
                                <option value="status">Online/Offline</option>
                                <option value="system">Syst√©m</option>
                            </select>
                        </div>
                        <div class="grid grid-cols-4 gap-1">
                            <button id="levelAll" class="filter-level-btn active p-1 rounded text-xs bg-gray-700 hover:bg-gray-600">V≈°etky</button>
                            <button id="levelInfo" class="filter-level-btn p-1 rounded text-xs bg-blue-700 hover:bg-blue-600">Info</button>
                            <button id="levelWarning" class="filter-level-btn p-1 rounded text-xs bg-yellow-700 hover:bg-yellow-600">Warn</button>
                            <button id="levelError" class="filter-level-btn p-1 rounded text-xs bg-red-700 hover:bg-red-600">Error</button>
                        </div>
                    </div>
                    
                    <div id="logsContainer" class="flex-1 overflow-y-auto space-y-1 pr-2 text-xs" style="min-height: 200px;"></div>
                </div>
            </div>
        </div>

        <!-- Mobiln√° verzia activity logu - zobrazuje sa pod hlavn√Ωm obsahom -->
        <div id="mobileLogs" class="lg:hidden">
            <div class="card p-4 rounded-lg mt-8 flex flex-col">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-white">üìã Aktivita</h2>
                    <div class="flex gap-1">
                        <button id="refreshLogsBtnMobile" class="btn bg-blue-600 hover:bg-blue-700 text-white font-bold py-1 px-2 rounded text-xs flex items-center gap-1">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                        <button id="exportLogsBtnMobile" class="btn bg-green-600 hover:bg-green-700 text-white font-bold py-1 px-2 rounded text-xs flex items-center gap-1">
                            <i class="fas fa-download"></i>
                        </button>
                        <button id="logsFilterBtnMobile" class="btn bg-purple-600 hover:bg-purple-700 text-white font-bold py-1 px-2 rounded text-xs flex items-center gap-1">
                            <i class="fas fa-filter"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Mobiln√© filtre pre logy -->
                <div id="logsFiltersMobile" class="mb-3 space-y-2 hidden">
                    <div class="grid grid-cols-1 gap-2">
                        <select id="deviceFilterMobile" class="p-2 rounded bg-gray-800 border border-gray-600 text-sm">
                            <option value="">V≈°etky zariadenia</option>
                        </select>
                        <select id="typeFilterMobile" class="p-2 rounded bg-gray-800 border border-gray-600 text-sm">
                            <option value="">V≈°etky typy</option>
                            <option value="backup">Z√°lohovanie</option>
                            <option value="notification">Notifik√°cie</option>
                            <option value="status">Online/Offline</option>
                            <option value="system">Syst√©m</option>
                        </select>
                    </div>
                    <div class="grid grid-cols-2 gap-1">
                        <button id="levelAllMobile" class="filter-level-btn-mobile active p-2 rounded text-sm bg-gray-700 hover:bg-gray-600">V≈°etky</button>
                        <button id="levelInfoMobile" class="filter-level-btn-mobile p-2 rounded text-sm bg-blue-700 hover:bg-blue-600">Info</button>
                    </div>
                    <div class="grid grid-cols-2 gap-1">
                        <button id="levelWarningMobile" class="filter-level-btn-mobile p-2 rounded text-sm bg-yellow-700 hover:bg-yellow-600">Warn</button>
                        <button id="levelErrorMobile" class="filter-level-btn-mobile p-2 rounded text-sm bg-red-700 hover:bg-red-600">Error</button>
                    </div>
                </div>
                
                <div id="logsContainerMobile" class="overflow-y-auto space-y-1 pr-2 text-xs" style="max-height: 400px;"></div>
            </div>
        </div>
        </div>

    <!-- Modals -->
    <div id="deviceModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center hidden z-50">
        <div class="card p-8 rounded-lg w-full max-w-md modal-content">
            <h2 class="text-2xl font-bold text-white mb-6">Prida≈•/Upravi≈• zariadenie</h2>
            <form id="deviceForm" class="space-y-4">
                <input type="hidden" id="deviceId">
                <div><label for="deviceName" class="block mb-1 font-semibold">N√°zov zariadenia</label><input type="text" id="deviceName" class="w-full p-2 rounded bg-gray-800 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-sky-500" required></div>
                <div><label for="deviceIp" class="block mb-1 font-semibold">IP Adresa</label><input type="text" id="deviceIp" class="w-full p-2 rounded bg-gray-800 border border-gray-600" required></div>
                <div><label for="deviceUsername" class="block mb-1 font-semibold">Pou≈æ√≠vateƒæsk√© meno</label><input type="text" id="deviceUsername" class="w-full p-2 rounded bg-gray-800 border border-gray-600" required></div>
                <div><label for="devicePassword" class="block mb-1 font-semibold">Heslo</label><input type="password" id="devicePassword" class="w-full p-2 rounded bg-gray-800 border border-gray-600" placeholder="Zadajte heslo pre SSH pripojenie"></div>
                <div><label for="deviceSnmpCommunity" class="block mb-1 font-semibold">SNMP Community</label><input type="text" id="deviceSnmpCommunity" class="w-full p-2 rounded bg-gray-800 border border-gray-600" placeholder="public"></div>
                <div><label for="deviceSnmpInterval" class="block mb-1 font-semibold">SNMP monitoring interval (min√∫ty)</label><input type="number" id="deviceSnmpInterval" class="w-full p-2 rounded bg-gray-800 border border-gray-600" value="0" min="0" max="1440"><small class="text-gray-400 block mt-1">0 = pou≈æi≈• glob√°lne nastavenie, 1-1440 = vlastn√Ω interval v min√∫tach</small></div>
                <div class="flex items-center"><input type="checkbox" id="deviceLowMemory" class="h-4 w-4 rounded text-sky-500 focus:ring-sky-500"><label for="deviceLowMemory" class="ml-2">Zariadenie s n√≠zkou pam√§≈•ou (16MB)</label></div>
                <div class="flex justify-end gap-4 mt-6"><button type="button" id="cancelDeviceBtn" class="btn bg-gray-600 hover:bg-gray-700 py-2 px-4 rounded-lg">Zru≈°i≈•</button><button type="submit" class="btn btn-primary font-bold py-2 px-4 rounded-lg">Ulo≈æi≈•</button></div>
            </form>
        </div>
    </div>
    
    <div id="settingsModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center hidden z-50 p-4">
        <div class="card p-6 md:p-8 rounded-lg w-full max-w-sm md:max-w-4xl modal-content max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl md:text-2xl font-bold text-white">‚öôÔ∏è Nastavenia</h2>
                <button id="closeSettingsBtn" class="btn bg-gray-600 hover:bg-gray-700 text-white p-2 rounded-lg md:inline-block hidden">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="settingsForm" class="space-y-6 md:space-y-8">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8">
                    <!-- ƒΩav√Ω stƒ∫pec -->
                    <div class="space-y-6 md:space-y-8">
                        <div>
                            <h3 class="text-lg md:text-xl font-semibold border-b border-gray-600 pb-2 mb-4 text-sky-400">‚è∞ Automatick√© z√°lohovanie</h3>
                            <div class="space-y-4">
                                <div class="flex items-center"><input type="checkbox" id="backup_schedule_enabled" name="backup_schedule_enabled" class="h-4 w-4 rounded text-sky-500 focus:ring-sky-500"><label for="backup_schedule_enabled" class="ml-2">Povoli≈• automatick√© z√°lohovanie</label></div>
                                <div><label for="backup_schedule_type" class="block mb-1">Interval</label><select id="backup_schedule_type" name="backup_schedule_type" class="w-full p-2 rounded bg-gray-800 border border-gray-600"><option value="daily">Denne</option><option value="weekly">T√Ω≈ædenne</option></select></div>
                                <div id="weeklySettings" class="hidden"><label for="backup_schedule_day" class="block mb-1">De≈à v t√Ω≈ædni</label><select id="backup_schedule_day" name="backup_schedule_day" class="w-full p-2 rounded bg-gray-800 border border-gray-600"><option value="monday">Pondelok</option><option value="tuesday">Utorok</option><option value="wednesday">Streda</option><option value="thursday">≈†tvrtok</option><option value="friday">Piatok</option><option value="saturday">Sobota</option><option value="sunday">Nedeƒæa</option></select></div>
                                <div><label for="backup_schedule_time" class="block mb-1">ƒåas (HH:MM)</label><input type="time" id="backup_schedule_time" name="backup_schedule_time" class="w-full p-2 rounded bg-gray-800 border border-gray-600"></div>
                                <div><label for="backup_retention_count" class="block mb-1 font-semibold">Poƒçet uchov√°van√Ωch z√°loh (na zariadenie)</label><input type="number" id="backup_retention_count" name="backup_retention_count" class="w-full p-2 rounded bg-gray-800 border border-gray-600" value="10" min="1"></div>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-lg md:text-xl font-semibold border-b border-gray-600 pb-2 mb-4 text-sky-400">üì¶ Hromadn√© z√°lohovanie</h3>
                            <div class="space-y-4">
                                <div><label for="backup_delay_seconds" class="block mb-1 font-semibold">Oneskorenie medzi z√°lohami (sekundy)</label><input type="number" id="backup_delay_seconds" name="backup_delay_seconds" class="w-full p-2 rounded bg-gray-800 border border-gray-600" value="30" min="5" max="300"><small class="text-gray-400 block mt-1">Odpor√∫ƒçan√Ω rozsah: 30-60 sek√∫nd. Krat≈°√≠ ƒças m√¥≈æe pre≈•a≈æi≈• sie≈•.</small></div>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-lg md:text-xl font-semibold border-b border-gray-600 pb-2 mb-4 text-sky-400">üìä SNMP Monitoring</h3>
                            <div class="space-y-4">
                                <div><label for="snmp_check_interval_minutes" class="block mb-1 font-semibold">Glob√°lny interval SNMP kontroly (min√∫ty)</label><input type="number" id="snmp_check_interval_minutes" name="snmp_check_interval_minutes" class="w-full p-2 rounded bg-gray-800 border border-gray-600" value="10" min="1" max="1440"><small class="text-gray-400 block mt-1">Predvolen√Ω interval pre zariadenia, ktor√© nemaj√∫ nastaven√Ω vlastn√Ω interval. Rozsah: 1-1440 min√∫t</small>
                                <div class="mt-2 p-3 bg-blue-900/30 border border-blue-500/50 rounded-lg">
                                    <div class="flex items-start gap-2">
                                        <i class="fas fa-info-circle text-blue-400 mt-0.5"></i>
                                        <div class="text-sm text-blue-200">
                                            <strong>üì± Pushover notifik√°cie:</strong> Notifik√°cie o online/offline stave zariaden√≠ s√∫ zalo≈æen√© na <strong>SNMP monitoringu</strong> a tomto intervale, nie na ICMP ping monitoringu z detailnej monitoring str√°nky.
                                        </div>
                                    </div>
                                </div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-lg md:text-xl font-semibold border-b border-gray-600 pb-2 mb-4 text-sky-400">üèì ICMP Ping Monitoring</h3>
                            <div class="space-y-4">
                                <div class="flex items-center"><input type="checkbox" id="ping_monitor_enabled" name="ping_monitor_enabled" class="h-4 w-4 rounded text-sky-500 focus:ring-sky-500"><label for="ping_monitor_enabled" class="ml-2">Povoli≈• ICMP ping monitoring</label><small class="text-gray-400 block mt-1">Ak je vypnut√©, ping monitoring sa nezachyt√°va</small></div>
                                <div><label for="ping_check_interval_seconds" class="block mb-1 font-semibold">Interval ping kontroly (sekundy)</label><input type="number" id="ping_check_interval_seconds" name="ping_check_interval_seconds" class="w-full p-2 rounded bg-gray-800 border border-gray-600" value="120" min="1" max="86400"><small class="text-gray-400 block mt-1">Interval medzi ping kontrolami. Rozsah: 1 sekunda a≈æ 24 hod√≠n (86400 sek√∫nd). Odpor√∫ƒçan√©: 30-300 sek√∫nd.</small></div>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-lg md:text-xl font-semibold border-b border-gray-600 pb-2 mb-4 text-sky-400">üìã Spr√°va logov a d√°t</h3>
                            <div class="space-y-4">
                                <div class="flex items-center"><input type="checkbox" id="backup_detailed_logging" name="backup_detailed_logging" class="h-4 w-4 rounded text-sky-500 focus:ring-sky-500"><label for="backup_detailed_logging" class="ml-2">Detailn√© logovanie z√°lohov√©ho procesu</label><small class="text-gray-400 block mt-1">Ak je vypnut√©, zobrazuj√∫ sa len z√°kladn√© spr√°vy o spusten√≠ a dokonƒçen√≠ z√°lohy</small></div>
                                <div><label for="log_retention_days" class="block mb-1 font-semibold">Poƒçet dn√≠ uchov√°vania logov</label><input type="number" id="log_retention_days" name="log_retention_days" class="w-full p-2 rounded bg-gray-800 border border-gray-600" value="30" min="1" max="365"><small class="text-gray-400 block mt-1">Logy star≈°ie ako tento poƒçet dn√≠ bud√∫ automaticky vymazan√©. Rozsah: 1-365 dn√≠</small></div>
                                <div><label for="ping_retention_days" class="block mb-1 font-semibold">Poƒçet dn√≠ uchov√°vania ping d√°t</label><input type="number" id="ping_retention_days" name="ping_retention_days" class="w-full p-2 rounded bg-gray-800 border border-gray-600" value="30" min="1" max="365"><small class="text-gray-400 block mt-1">Ping hist√≥ria pre grafy. Viac dn√≠ = v√§ƒç≈°ia datab√°za. Rozsah: 1-365 dn√≠</small></div>
                                <div><label for="snmp_retention_days" class="block mb-1 font-semibold">Poƒçet dn√≠ uchov√°vania SNMP d√°t</label><input type="number" id="snmp_retention_days" name="snmp_retention_days" class="w-full p-2 rounded bg-gray-800 border border-gray-600" value="30" min="1" max="365"><small class="text-gray-400 block mt-1">SNMP hist√≥ria (CPU, teplota, pam√§≈•). Viac dn√≠ = v√§ƒç≈°ia datab√°za. Rozsah: 1-365 dn√≠</small></div>
                                <div><label for="log_max_entries" class="block mb-1 font-semibold">Maximum logov v pam√§ti</label><input type="number" id="log_max_entries" name="log_max_entries" class="w-full p-2 rounded bg-gray-800 border border-gray-600" value="1000" min="100" max="5000"><small class="text-gray-400 block mt-1">Maxim√°lny poƒçet logov naƒç√≠tan√Ωch do prehliadaƒça. Vy≈°≈°ie ƒç√≠slo = viac RAM. Rozsah: 100-5000</small></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Prav√Ω stƒ∫pec -->
                    <div class="space-y-6 md:space-y-8">
                        <div>
                            <h3 class="text-lg md:text-xl font-semibold border-b border-gray-600 pb-2 mb-4 text-sky-400">üìÅ FTP Server</h3>
                            <div class="space-y-4">
                                <div><label for="ftp_server" class="block mb-1">FTP Server IP</label><input type="text" id="ftp_server" name="ftp_server" class="w-full p-2 rounded bg-gray-800 border border-gray-600"></div>
                                <div><label for="ftp_username" class="block mb-1">FTP Pou≈æ√≠vateƒæ</label><input type="text" id="ftp_username" name="ftp_username" class="w-full p-2 rounded bg-gray-800 border border-gray-600"></div>
                                <div><label for="ftp_password" class="block mb-1">FTP Heslo</label><input type="password" id="ftp_password" name="ftp_password" class="w-full p-2 rounded bg-gray-800 border border-gray-600"></div>
                                <div><label for="ftp_directory" class="block mb-1">FTP Adres√°r</label><input type="text" id="ftp_directory" name="ftp_directory" class="w-full p-2 rounded bg-gray-800 border border-gray-600"></div>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-lg md:text-xl font-semibold border-b border-gray-600 pb-2 mb-4 text-sky-400">üì± Inteligentn√© Notifik√°cie (Pushover)</h3>
                            <div class="mb-4 p-3 bg-amber-900/30 border border-amber-500/50 rounded-lg">
                                <div class="flex items-start gap-2">
                                    <i class="fas fa-exclamation-triangle text-amber-400 mt-0.5"></i>
                                    <div class="text-sm text-amber-200">
                                        <strong>D√¥le≈æit√©:</strong> Notifik√°cie o online/offline stave zariaden√≠ s√∫ sp√∫≈°≈•an√© <strong>SNMP monitoringom</strong> (viƒè sekcia "üìä SNMP Monitoring"), nie ICMP ping testami z monitoring str√°nky.
                                    </div>
                                </div>
                            </div>
                            <div class="space-y-4">
                                <div><label for="pushover_app_key" class="block mb-1 font-semibold">Pushover App Key/Token</label><input type="text" id="pushover_app_key" name="pushover_app_key" class="w-full p-2 rounded bg-gray-800 border border-gray-600" placeholder="V√°≈° App Key z Pushover"></div>
                                <div><label for="pushover_user_key" class="block mb-1 font-semibold">Pushover User Key</label><input type="text" id="pushover_user_key" name="pushover_user_key" class="w-full p-2 rounded bg-gray-800 border border-gray-600" placeholder="V√°≈° User Key z Pushover"></div>
                                <h4 class="font-semibold pt-2">Typy notifik√°ci√≠</h4>
                                <div id="notificationTypes" class="grid grid-cols-1 md:grid-cols-2 gap-x-4 gap-y-2"></div>
                                <h4 class="font-semibold pt-2">Kritick√© limity</h4>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div><label for="temp_critical_threshold" class="block mb-1">Teplota (¬∞C)</label><input type="number" id="temp_critical_threshold" name="temp_critical_threshold" class="w-full p-2 rounded bg-gray-800 border border-gray-600"></div>
                                    <div><label for="cpu_critical_threshold" class="block mb-1">CPU (%)</label><input type="number" id="cpu_critical_threshold" name="cpu_critical_threshold" class="w-full p-2 rounded bg-gray-800 border border-gray-600"></div>
                                    <div><label for="memory_critical_threshold" class="block mb-1">Pam√§≈• (%)</label><input type="number" id="memory_critical_threshold" name="memory_critical_threshold" class="w-full p-2 rounded bg-gray-800 border border-gray-600"></div>
                                </div>
                                <h4 class="font-semibold pt-2">Obmedzenia</h4>
                                <div class="flex items-center"><input type="checkbox" id="quiet_hours_enabled" name="quiet_hours_enabled" class="h-4 w-4 rounded text-sky-500 focus:ring-sky-500"><label for="quiet_hours_enabled" class="ml-2">Povoli≈• "Quiet Hours" (tich√Ω re≈æim)</label></div>
                                <div class="grid grid-cols-2 gap-4">
                                    <div><label for="quiet_hours_start" class="block mb-1">Tich√Ω re≈æim od</label><input type="time" id="quiet_hours_start" name="quiet_hours_start" class="w-full p-2 rounded bg-gray-800 border border-gray-600"></div>
                                    <div><label for="quiet_hours_end" class="block mb-1">Tich√Ω re≈æim do</label><input type="time" id="quiet_hours_end" name="quiet_hours_end" class="w-full p-2 rounded bg-gray-800 border border-gray-600"></div>
                                </div>
                                <div><button type="button" id="testPushoverBtn" class="btn bg-teal-600 hover:bg-teal-700 text-white font-bold py-2 px-4 rounded-lg w-full flex items-center justify-center gap-2"><i class="fas fa-paper-plane"></i> Otestova≈• Notifik√°ciu</button></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="flex justify-end gap-4 pt-6 border-t border-gray-700"><button type="button" id="cancelSettingsBtn" class="btn bg-gray-600 hover:bg-gray-700 py-2 px-4 rounded-lg">Zru≈°i≈•</button><button type="submit" class="btn btn-primary font-bold py-2 px-4 rounded-lg">Ulo≈æi≈• nastavenia</button></div>
            </form>
        </div>
    </div>

    <div id="manageAccountModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center hidden z-50">
        <div class="card p-8 rounded-lg w-full max-w-2xl modal-content max-h-[90vh] overflow-y-auto">
            <h2 class="text-2xl font-bold text-white mb-6">üë§ Spr√°va pou≈æ√≠vateƒæsk√©ho √∫ƒçtu</h2>
            <div id="accountManageMessage" class="hidden p-3 rounded-md mb-4 text-sm"></div>
            
            <!-- Tabs -->
            <div class="flex border-b border-gray-600 mb-6">
                <button id="tabUsername" class="account-tab active px-4 py-2 text-sky-400 border-b-2 border-sky-400">Pou≈æ√≠vateƒæsk√© meno</button>
                <button id="tabPassword" class="account-tab px-4 py-2 text-gray-400 border-b-2 border-transparent hover:text-sky-400">Heslo</button>
                <button id="tab2FA" class="account-tab px-4 py-2 text-gray-400 border-b-2 border-transparent hover:text-sky-400">2FA</button>
            </div>
            
            <!-- Username Tab -->
            <div id="tabUsernameContent" class="tab-content">
                <form id="changeUsernameForm" class="space-y-4">
                    <div>
                        <label for="currentUsernameDisplay" class="block mb-1 font-semibold">Aktu√°lne pou≈æ√≠vateƒæsk√© meno</label>
                        <input type="text" id="currentUsernameDisplay" class="w-full p-2 rounded bg-gray-700 border border-gray-600 text-gray-400" readonly>
                    </div>
                    <div>
                        <label for="newUsername" class="block mb-1 font-semibold">Nov√© pou≈æ√≠vateƒæsk√© meno</label>
                        <input type="text" id="newUsername" class="w-full p-2 rounded bg-gray-800 border border-gray-600" required 
                               placeholder="Len p√≠smen√°, ƒç√≠slice, _ a -" pattern="[a-zA-Z0-9_-]+">
                        <small class="text-gray-400 text-xs">Minim√°lne 3 znaky, maxim√°lne 50 znakov</small>
                    </div>
                    <div>
                        <label for="confirmPasswordUsername" class="block mb-1 font-semibold">Potvrdenie hesla</label>
                        <input type="password" id="confirmPasswordUsername" class="w-full p-2 rounded bg-gray-800 border border-gray-600" required>
                    </div>
                    <div class="flex justify-end gap-4 mt-6">
                        <button type="submit" class="btn btn-primary font-bold py-2 px-4 rounded-lg">Zmeni≈• pou≈æ√≠vateƒæsk√© meno</button>
                    </div>
                </form>
            </div>
            
            <!-- Password Tab -->
            <div id="tabPasswordContent" class="tab-content hidden">
                <form id="changePasswordForm" class="space-y-4">
                    <div>
                        <label for="oldPassword" class="block mb-1 font-semibold">Star√© heslo</label>
                        <div class="password-input-container">
                            <input type="password" id="oldPassword" class="w-full p-2 pr-10 rounded bg-gray-800 border border-gray-600" required>
                            <i class="fas fa-eye password-toggle" data-target="oldPassword"></i>
                        </div>
                    </div>
                    <div>
                        <label for="newPassword" class="block mb-1 font-semibold">Nov√© heslo</label>
                        <div class="password-input-container">
                            <input type="password" id="newPassword" class="w-full p-2 pr-10 rounded bg-gray-800 border border-gray-600" required>
                            <i class="fas fa-eye password-toggle" data-target="newPassword"></i>
                        </div>
                    </div>
                    <div>
                        <label for="newPasswordConfirm" class="block mb-1 font-semibold">Potvrdenie nov√©ho hesla</label>
                        <div class="password-input-container">
                            <input type="password" id="newPasswordConfirm" class="w-full p-2 pr-10 rounded bg-gray-800 border border-gray-600" required>
                            <i class="fas fa-eye password-toggle" data-target="newPasswordConfirm"></i>
                        </div>
                    </div>
                    <div class="flex justify-end gap-4 mt-6">
                        <button type="submit" class="btn btn-primary font-bold py-2 px-4 rounded-lg">Zmeni≈• heslo</button>
                    </div>
                </form>
            </div>
            
            <!-- 2FA Tab -->
            <div id="tab2FAContent" class="tab-content hidden">
                <div id="backup2faControls" class="space-y-4">
                    <div class="bg-gray-800 p-4 rounded-lg">
                        <h3 class="text-lg font-semibold text-white mb-2">üì± Z√°lo≈æn√© k√≥dy</h3>
                        <p class="text-gray-400 text-sm mb-3">Z√°lo≈æn√© k√≥dy umo≈æ≈àuj√∫ pr√≠stup k v√°≈°mu √∫ƒçtu aj keƒè nem√°te k dispoz√≠cii svoje zariadenie s autentifik√°torom.</p>
                        <div id="backupCodesInfo" class="mb-3">
                            <p class="text-sm text-gray-300">Zost√°va v√°m: <span id="remainingCodes" class="font-semibold text-sky-400">-</span> k√≥dov</p>
                        </div>
                        <button id="generateBackupCodesBtn" class="btn bg-amber-600 hover:bg-amber-700 text-white font-bold py-2 px-4 rounded-lg">
                            <i class="fas fa-key mr-2"></i>Regenerova≈• z√°lo≈æn√© k√≥dy
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="flex justify-end gap-4 pt-6 border-t border-gray-700 mt-6">
                <button type="button" id="cancelAccountManageBtn" class="btn bg-gray-600 hover:bg-gray-700 py-2 px-4 rounded-lg">Zatvori≈•</button>
            </div>
        </div>
    </div>

    <!-- Password Confirmation Modal for Backup Codes -->
    <div id="confirmPasswordModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center hidden z-50">
        <div class="card p-8 rounded-lg w-full max-w-md modal-content">
            <h2 class="text-xl font-bold text-white mb-4">Potvrdenie hesla</h2>
            <p class="text-gray-400 text-sm mb-4">Pre regener√°ciu z√°lo≈æn√Ωch k√≥dov je potrebn√© potvrdi≈• va≈°e heslo.</p>
            <div id="confirmPasswordMessage" class="hidden p-3 rounded-md mb-4 text-sm"></div>
            <form id="confirmPasswordForm" class="space-y-4">
                <div>
                    <label for="confirmPasswordInput" class="block mb-1 font-semibold">Heslo</label>
                    <input type="password" id="confirmPasswordInput" class="w-full p-2 rounded bg-gray-800 border border-gray-600" required>
                </div>
                <div class="flex justify-end gap-4 mt-6">
                    <button type="button" id="cancelConfirmPasswordBtn" class="btn bg-gray-600 hover:bg-gray-700 py-2 px-4 rounded-lg">Zru≈°i≈•</button>
                    <button type="submit" class="btn btn-primary font-bold py-2 px-4 rounded-lg">Potvrdi≈•</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Backup Codes Display Modal -->
    <div id="backupCodesModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center hidden z-50">
        <div class="card p-8 rounded-lg w-full max-w-lg modal-content">
            <h2 class="text-xl font-bold text-white mb-4">üîë Va≈°e nov√© z√°lo≈æn√© k√≥dy</h2>
            <div class="bg-red-800 p-4 rounded-lg mb-4">
                <p class="text-red-200 text-sm"><i class="fas fa-exclamation-triangle mr-2"></i><strong>D√¥le≈æit√©:</strong> Ulo≈æte si tieto k√≥dy na bezpeƒçn√© miesto. Ka≈æd√Ω k√≥d mo≈æno pou≈æi≈• iba jedenkr√°t!</p>
            </div>
            <div id="backupCodesDisplay" class="grid grid-cols-2 gap-2 mb-6 font-mono text-sm">
                <!-- Backup codes will be inserted here -->
            </div>
            <div class="flex flex-col sm:flex-row gap-4 mb-4">
                <button id="downloadCodesBtn" class="btn bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg flex items-center justify-center">
                    <i class="fas fa-download mr-2"></i>Stiahnu≈• ako s√∫bor
                </button>
                <button id="printCodesBtn" class="btn bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg flex items-center justify-center">
                    <i class="fas fa-print mr-2"></i>Vytlaƒçi≈•
                </button>
            </div>
            <div class="flex justify-end">
                <button id="closeBackupCodesBtn" class="btn btn-primary font-bold py-2 px-4 rounded-lg">Dokonƒçi≈•</button>
            </div>
        </div>
    </div>

    <div id="snmpStatusModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center hidden z-50 p-4">
        <div class="card p-8 rounded-lg w-full max-w-4xl modal-content max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-white">üõ°Ô∏è SNMP Monitoring Stav</h2>
                <div class="flex gap-2">
                    <button id="refreshSnmpStatusBtn" class="btn bg-gray-600 hover:bg-gray-700 text-white p-2 rounded-lg text-sm opacity-70 hover:opacity-100 transition-opacity" title="Obnovi≈• SNMP stav">
                        <i class="fas fa-sync-alt text-xs"></i>
                    </button>
                    <button id="closeSnmpStatusBtn" class="btn bg-gray-600 hover:bg-gray-700 text-white p-2 rounded-lg">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div id="snmpStatusContent">
                <div class="flex justify-center items-center py-8">
                    <i class="fas fa-spinner fa-spin text-2xl text-sky-500 mr-3"></i>
                    <span class="text-lg">Naƒç√≠tavam SNMP stav...</span>
                </div>
            </div>
        </div>
    </div>

<script>
// Funkcie pre spr√°vu refresh stavu
const setRefreshingState = (enable = true) => {
    if (enable) {
        document.body.classList.add('refreshing');
    } else {
        document.body.classList.remove('refreshing');
    }
};

document.addEventListener('DOMContentLoaded', () => {
    // Optimalizovan√Ω startup - minim√°lny loading overlay
    setRefreshingState(true);
    
    // Veƒæmi r√Ωchlo vypneme - umo≈æn√≠me pou≈æ√≠vateƒæovi interakciu ƒço najsk√¥r
    setTimeout(() => {
        setRefreshingState(false);
    }, 300); // E≈°te krat≈°ie - len 300ms
    
    const API_URL = '';
    const devicesGrid = document.getElementById('devicesGrid');
    const logsContainer = document.getElementById('logsContainer');
    const deviceModal = document.getElementById('deviceModal');
    const settingsModal = document.getElementById('settingsModal');
    const manageAccountModal = document.getElementById('manageAccountModal');
    const confirmPasswordModal = document.getElementById('confirmPasswordModal');
    const backupCodesModal = document.getElementById('backupCodesModal');
    const snmpStatusModal = document.getElementById('snmpStatusModal');
    const deviceForm = document.getElementById('deviceForm');
    const settingsForm = document.getElementById('settingsForm');
    const changePasswordForm = document.getElementById('changePasswordForm');
    const changeUsernameForm = document.getElementById('changeUsernameForm');
    const notificationTypes = {
        notify_device_offline: "üî¥ Zariadenie offline", notify_device_online: "‚úÖ Zariadenie online",
        notify_backup_success: "‚úÖ Z√°loha √∫spe≈°n√°",
        notify_high_temperature: "üå°Ô∏è Vysok√° teplota", notify_high_cpu: "‚ö° Vysok√© CPU",
        notify_low_memory: "üíæ M√°lo pam√§te",
        notify_reboot_detected: "üîÑ Reboot detekovan√Ω", notify_version_change: "üÜï Zmena verzie OS",
    };

    // --- ≈†tandardizovan√Ω pomocn√≠k pre API volania ---
    const api = {
        _handleResponse: async (res) => {
            if (res.status === 401) {
                window.location.href = '/login';
                return {};
            }
            
            try {
                const data = await res.json();
                
                // Ak server vr√°ti chybu, ale JSON je validn√Ω
                if (!res.ok) {
                    throw new Error(data.message || `HTTP ${res.status}: ${res.statusText}`);
                }
                
                return data;
            } catch (error) {
                // Ak JSON parsing zlyh√°
                if (!res.ok) {
                    throw new Error(`HTTP ${res.status}: ${res.statusText}`);
                }
                throw error;
            }
        },
        
        get: async function(endpoint) {
            const res = await fetch(`${API_URL}/api/${endpoint}`);
            return this._handleResponse(res);
        },
        
        post: async function(endpoint, body) {
            const res = await fetch(`${API_URL}/api/${endpoint}`, { 
                method: 'POST', 
                headers: { 'Content-Type': 'application/json' }, 
                body: JSON.stringify(body) 
            });
            return this._handleResponse(res);
        },
        
        delete: async function(endpoint) {
            const res = await fetch(`${API_URL}/api/${endpoint}`, { method: 'DELETE' });
            return this._handleResponse(res);
        }
    };    const loadUserStatus = async () => {
        try {
            const data = await api.get('user/status');
            if (data.username) {
                document.getElementById('userStatus').innerHTML = `
                    <span class="text-sm text-gray-400 mr-4 hidden md:inline">Prihl√°sen√Ω ako: <strong class="font-semibold text-gray-200">${data.username}</strong></span>
                    <div class="flex items-center gap-2 text-sm">
                        <a href="#" id="manageAccountLink" class="text-sky-500 hover:text-sky-400 hover:underline">Upravi≈•</a>
                        <span class="text-gray-600">|</span>
                        <a href="/logout" class="text-sky-500 hover:text-sky-400 hover:underline">Odhl√°si≈•</a>
                    </div>
                `;
                document.getElementById('manageAccountLink').addEventListener('click', (e) => {
                    e.preventDefault();
                    // Fill current username display
                    document.getElementById('currentUsernameDisplay').value = data.username;
                    manageAccountModal.classList.remove('hidden');
                });
            }
        } catch (error) {
            console.error('Chyba pri naƒç√≠tan√≠ stavu pou≈æ√≠vateƒæa:', error);
        }
    };

    // === WebSocket SNMP Refresh Progress Handler ===
    let isSnmpRefreshRunning = false;
    
    const updateSnmpRefreshButton = (status, current = 0, total = 0, message = '') => {
        const btn = document.getElementById('refreshAllSnmpBtn');
        const icon = btn.querySelector('i');
        
        switch (status) {
            case 'started':
            case 'processing':
                isSnmpRefreshRunning = true;
                icon.classList.add('fa-spin');
                btn.disabled = true;
                btn.innerHTML = `<i class="fas fa-spinner fa-spin"></i> ${current}/${total}`;
                break;
                
            case 'completed':
            case 'stopped':
            case 'error':
                isSnmpRefreshRunning = false;
                icon.classList.remove('fa-spin');
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-sync"></i> Refresh SNMP';
                break;
        }
    };

    const socket = io();
    let isWebSocketConnected = false;
    
    // WebSocket event handlers
    socket.on('connect', () => {
        isWebSocketConnected = true;
        // Logy sa naƒç√≠taj√∫ v initializeApp(), nie tu
    });
    
    socket.on('disconnect', () => {
        isWebSocketConnected = false;
        // Logy sa bud√∫ obnovova≈• len manu√°lne cez refresh tlaƒçidlo
    });
    
    socket.on('log_update', (log) => {
        // Prid√°me log len ak je WebSocket pripojen√Ω
        if (isWebSocketConnected) {
            addLog(log.level, log.message, log.device_ip, log.timestamp);
        }
    });
    
    socket.on('snmp_update', ({ id, data, status }) => {
        // Zastav√≠me spinning efekt na SNMP tlaƒçidle po update
        const card = document.querySelector(`[data-id="${id}"]`);
        if (card) {
            const snmpBtn = card.querySelector('.snmp-btn');
            if (snmpBtn) {
                const icon = snmpBtn.querySelector('i');
                if (icon) {
                    icon.classList.remove('fa-spin');
                }
                snmpBtn.disabled = false;
            }
        }
        updateDeviceCard(id, { last_snmp_data: JSON.stringify(data), status });
    });
    
    socket.on('snmp_refresh_progress', (progressData) => {
        updateSnmpRefreshButton(progressData.status, progressData.current, progressData.total, progressData.message);
        
        // Ak m√°me inform√°cie o aktu√°lnom zariaden√≠, zobraz√≠me spinning efekt
        if (progressData.status === 'processing' && progressData.current_device) {
            const card = document.querySelector(`[data-id="${progressData.current_device.id}"]`);
            if (card) {
                const snmpBtn = card.querySelector('.snmp-btn');
                const snmpIcon = snmpBtn?.querySelector('i');
                if (snmpIcon) {
                    snmpIcon.classList.add('fa-spin');
                }
                if (snmpBtn) {
                    snmpBtn.disabled = true;
                }
            }
        }
    });
    socket.on('backup_status', ({ ip, id, status, last_backup }) => {
        const card = document.querySelector(`[data-id="${id}"]`);
        if (card) {
            card.querySelector('.backup-btn i').classList.remove('spinning');
            if (last_backup) card.querySelector('.last-backup-val').textContent = new Date(last_backup).toLocaleString('sk-SK');
            
            // Ak bola z√°loha zastaven√°, zobraz√≠me spr√°vu
            if (status === 'stopped') {
                addLog('warning', `Z√°loha pre ${ip} bola zastaven√° pou≈æ√≠vateƒæom.`, ip);
            }
        }
    });

    const createDeviceCard = (device) => {
        const snmpData = device.last_snmp_data ? JSON.parse(device.last_snmp_data) : {};
        const deviceStatus = device.status || 'unknown';
        const statusClass = deviceStatus === 'online' ? 'status-online' : 
                           deviceStatus === 'offline' ? 'status-offline' : 'status-unknown';
        const card = document.createElement('div');
        card.className = 'card p-6 rounded-lg flex flex-col gap-4';
        card.dataset.id = device.id;
        card.dataset.ip = device.ip;
        card.innerHTML = `
            <div class="h-20 flex flex-col justify-between">
                <div class="grid grid-cols-[1fr_auto] gap-4 items-start">
                    <h3 class="text-xl font-bold text-white leading-tight line-clamp-2">${device.name}</h3>
                    <span class="font-mono text-sm font-semibold ${statusClass} whitespace-nowrap flex items-center flex-shrink-0"><i class="fas fa-circle mr-2"></i>${deviceStatus}</span>
                </div>
                <p class="font-mono text-gray-400 mt-auto">${device.ip}</p>
            </div>
            <div class="grid grid-cols-2 gap-2 text-sm">
                <p><strong>Verzia:</strong> <span class="font-mono text-gray-300">${snmpData.version || 'N/A'}</span></p>
                <p><strong>Board:</strong> <span class="font-mono text-gray-300">${snmpData.board_name || 'N/A'}</span></p>
                <p><strong>Uptime:</strong> <span class="font-mono text-gray-300">${snmpData.uptime || 'N/A'}</span></p>
                <p><strong>CPU:</strong> <span class="font-mono text-gray-300">${snmpData.cpu_load || 'N/A'}%</span></p>
                <p><strong>Teplota:</strong> <span class="font-mono text-gray-300">${snmpData.temperature || 'N/A'} ¬∞C</span></p>
                <p><strong>CPU jadr√°:</strong> <span class="font-mono text-gray-300">${snmpData.cpu_count || 'N/A'}</span></p>
                <p><strong>SNMP interval:</strong> <span class="font-mono text-gray-300">${device.snmp_interval_minutes ? device.snmp_interval_minutes + 'min' : 'glob√°lny'}</span></p>
                <div><strong>Posl. z√°loha:</strong><br><span class="font-mono text-gray-300 last-backup-val">${device.last_backup ? new Date(device.last_backup).toLocaleString('sk-SK') : 'Nikdy'}</span></div>
            </div>
            <div class="flex gap-2 mt-auto pt-4 border-t border-gray-700">
                <button class="backup-btn btn flex-grow bg-emerald-600 hover:bg-emerald-700 text-white font-semibold py-1 px-1.5 rounded-lg device-btn-text flex items-center justify-center gap-1.5"><i class="fas fa-save device-btn-icon"></i> Z√°lohova≈•</button>
                <button class="snmp-btn btn flex-grow bg-sky-600 hover:bg-sky-700 text-white font-semibold py-1 px-1.5 rounded-lg device-btn-text flex items-center justify-center gap-1.5"><i class="fas fa-sync device-btn-icon"></i> SNMP</button>
                <button class="edit-btn btn bg-amber-500 hover:bg-amber-600 text-white font-semibold py-1 px-1.5 rounded-lg text-xs"><i class="fas fa-pencil-alt text-xs"></i></button>
                <button class="delete-btn btn bg-red-500 hover:bg-red-600 text-white font-semibold py-1 px-1.5 rounded-lg text-xs"><i class="fas fa-trash text-xs"></i></button>
            </div>`;
        card.querySelector('.backup-btn').addEventListener('click', (e) => { e.currentTarget.querySelector('i').classList.add('spinning'); api.post(`backup/${device.id}`); });
        card.querySelector('.snmp-btn').addEventListener('click', (e) => { 
            const btn = e.currentTarget;
            const icon = btn.querySelector('i');
            icon.classList.add('fa-spin');
            btn.disabled = true;
            api.get(`snmp/${device.id}`).catch(error => {
                // Pri chybe zastav√≠me spinning manu√°lne
                icon.classList.remove('fa-spin');
                btn.disabled = false;
            });
            // Socket handler automaticky zastav√≠ spinning pri √∫spe≈°nom update
        });
        card.querySelector('.edit-btn').addEventListener('click', () => openDeviceModal(device));
        card.querySelector('.delete-btn').addEventListener('click', () => deleteDevice(device.id, device.ip));
        return card;
    };
    
    const updateDeviceCard = (id, data) => {
        const card = document.querySelector(`[data-id="${id}"]`);
        if (!card) return;
        
        // Aktualizujeme √∫daje PRIAMO bez ak√Ωchkoƒævek vizu√°lnych efektov
        if (data.last_snmp_data) {
            const snmpData = JSON.parse(data.last_snmp_data);
            const statusEl = card.querySelector('.font-mono.text-sm.font-semibold.whitespace-nowrap');
            
            // Priama aktualiz√°cia statusu bez anim√°ci√≠
            statusEl.innerHTML = `<i class="fas fa-circle mr-2"></i>${data.status}`;
            statusEl.className = `font-mono text-sm font-semibold status-${data.status} whitespace-nowrap flex items-center flex-shrink-0`;
            
            // Priama aktualiz√°cia hodn√¥t bez anim√°ci√≠
            const updateValueDirect = (selector, newValue) => {
                const element = card.querySelector(selector);
                if (element) {
                    element.textContent = newValue;
                }
            };
            
            updateValueDirect('p:nth-child(1) span', snmpData.version || 'N/A');
            updateValueDirect('p:nth-child(2) span', snmpData.board_name || 'N/A');
            updateValueDirect('p:nth-child(3) span', snmpData.uptime || 'N/A');
            updateValueDirect('p:nth-child(4) span', (snmpData.cpu_load || 'N/A') + '%');
            updateValueDirect('p:nth-child(5) span', (snmpData.temperature || 'N/A') + ' ¬∞C');
            updateValueDirect('p:nth-child(6) span', snmpData.cpu_count || 'N/A');
        }
        
        if (data.last_backup) {
            const backupEl = card.querySelector('.last-backup-val');
            if (backupEl) {
                backupEl.textContent = new Date(data.last_backup).toLocaleString('sk-SK');
            }
        }
    };

    // Filtrovanie logov
    let currentFilters = {
        device: '',
        type: '',
        level: 'all'
    };
    
    // Flag pre potlaƒçenie automatick√©ho skrolovania poƒças refresh oper√°cie
    let suppressAutoScroll = false;
    
    // Glob√°lne nastavenia naƒç√≠tan√© zo servera
    let globalSettings = {
        log_retention_days: 30, // default hodnota
        ping_retention_days: 30, // default hodnota  
        snmp_retention_days: 30 // default hodnota
    };
    
    // Funkcia na kategoriz√°ciu logov podƒæa typu
    const categorizeLogMessage = (message) => {
        const msgLower = message.toLowerCase();
        // Pushover notifik√°cie maj√∫ prioritu a zost√°vaj√∫ v kateg√≥rii notification
        if (msgLower.includes('notifik√°cia') || msgLower.includes('notification') || msgLower.includes('pushover')) return 'notification';
        // V≈°etky z√°lohovacie spr√°vy vr√°tane "sp√∫≈°≈•am pokroƒçil√∫ z√°lohu" (okrem Pushover)
        if (msgLower.includes('z√°loha') || msgLower.includes('backup') || msgLower.includes('sp√∫≈°≈•am pokroƒçil√∫ z√°lohu')) return 'backup';
        // Online/Offline spr√°vy (okrem Pushover notifik√°ci√≠)
        if (msgLower.includes('online') || msgLower.includes('offline') || msgLower.includes('pripojen√©') || msgLower.includes('nedostupn√©')) return 'status';
        return 'system';
    };

    const addLogToContainer = (level, message, device_ip = '', timestamp = new Date().toISOString()) => {
        // Uprav√≠me level pre zelen√© spr√°vy
        if (message.includes('Automatick√© z√°lohovanie je akt√≠vne:') || 
            message.includes('Automatick√© z√°lohovanie je v nastaveniach vypnut√©.') ||
            message.includes('Nastavenia boli ulo≈æen√©.')) {
            level = 'info'; // Zmena z 'success' na 'info'
        }
        
        // Offline spr√°vy bud√∫ warning
        if (message.toLowerCase().includes('offline') || message.toLowerCase().includes('nedostupn√©')) {
            level = 'warning';
        }
        
        const logType = categorizeLogMessage(message);
        const createLogEntry = () => {
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry p-2 border-l-4 log-${level} bg-gray-800 text-sm`;
            logEntry.setAttribute('data-level', level);
            logEntry.setAttribute('data-device', device_ip || '');
            logEntry.setAttribute('data-type', logType);
            logEntry.setAttribute('data-timestamp', timestamp);
            
            logEntry.innerHTML = `<p><strong class="text-gray-400">${new Date(timestamp).toLocaleString('sk-SK')}</strong> ${device_ip ? `<span class="font-mono text-sky-400">${device_ip}</span>` : ''}: ${message}</p>`;
            return logEntry;
        };
        
        // Desktop logs - prid√°vame na zaƒçiatok
        const desktopLogEntry = createLogEntry();
        logsContainer.prepend(desktopLogEntry);
        
        // Mobile logs - prid√°vame na zaƒçiatok
        const mobileLogsContainer = document.getElementById('logsContainerMobile');
        if (mobileLogsContainer) {
            const mobileLogEntry = createLogEntry();
            mobileLogsContainer.prepend(mobileLogEntry);
            
            // Udr≈æujeme maxim√°lne poƒçet logov podƒæa nastaven√≠ (default 1000 ak nie je nastaven√©)
            const maxLogs = globalSettings.log_retention_days ? Math.min(globalSettings.log_retention_days * 50, 5000) : 1000;
            while (mobileLogsContainer.children.length > maxLogs) {
                mobileLogsContainer.lastChild.remove();
            }
        }
        
        // Udr≈æujeme maxim√°lne poƒçet logov podƒæa nastaven√≠ (default 1000 ak nie je nastaven√©)
        const maxLogs = globalSettings.log_retention_days ? Math.min(globalSettings.log_retention_days * 50, 5000) : 1000;
        while (logsContainer.children.length > maxLogs) {
            logsContainer.lastChild.remove();
        }
    };

    // Glob√°lna pam√§≈• pre d√¥le≈æit√© spr√°vy - ODSTR√ÅNEN√Å (zjednodu≈°ujeme logging)
    
    const addLog = (level, message, device_ip = '', timestamp = new Date().toISOString()) => {
        // √öplne ignorujeme startup spr√°vy
        if (message.includes('MikroTik Backup Manager') && message.includes('√∫spe≈°ne naƒç√≠tan√Ω!')) {
            return; // T√∫to spr√°vu u≈æ nezobrazujeme v√¥bec
        }
        
        // Uprav√≠me level pre zelen√© spr√°vy
        if (message.includes('Automatick√© z√°lohovanie je akt√≠vne:') || 
            message.includes('Automatick√© z√°lohovanie je v nastaveniach vypnut√©.') ||
            message.includes('Nastavenia boli ulo≈æen√©.')) {
            level = 'info'; // Zmena z 'success' na 'info'
        }
        
        // Offline spr√°vy bud√∫ warning
        if (message.toLowerCase().includes('offline') || message.toLowerCase().includes('nedostupn√©')) {
            level = 'warning';
        }
        
        const logType = categorizeLogMessage(message);
        const createLogEntry = () => {
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry p-2 border-l-4 log-${level} bg-gray-800 text-sm`;
            logEntry.setAttribute('data-level', level);
            logEntry.setAttribute('data-device', device_ip || '');
            logEntry.setAttribute('data-type', logType);
            logEntry.setAttribute('data-timestamp', timestamp);
            
            logEntry.innerHTML = `<p><strong class="text-gray-400">${new Date(timestamp).toLocaleString('sk-SK')}</strong> ${device_ip ? `<span class="font-mono text-sky-400">${device_ip}</span>` : ''}: ${message}</p>`;
            return logEntry;
        };
        
        // Desktop logs
        const desktopLogEntry = createLogEntry();
        logsContainer.prepend(desktopLogEntry);
        
        // Mobile logs
        const mobileLogsContainer = document.getElementById('logsContainerMobile');
        if (mobileLogsContainer) {
            const mobileLogEntry = createLogEntry();
            mobileLogsContainer.prepend(mobileLogEntry);
            
            // Udr≈æujeme maxim√°lne poƒçet logov podƒæa nastaven√≠ (default 1000 ak nie je nastaven√©)
            const maxLogs = globalSettings.log_retention_days ? Math.min(globalSettings.log_retention_days * 50, 5000) : 1000;
            while (mobileLogsContainer.children.length > maxLogs) {
                mobileLogsContainer.lastChild.remove();
            }
        }
        
        // Udr≈æujeme maxim√°lne poƒçet logov podƒæa nastaven√≠ (default 1000 ak nie je nastaven√©)
        const maxLogs = globalSettings.log_retention_days ? Math.min(globalSettings.log_retention_days * 50, 5000) : 1000;
        while (logsContainer.children.length > maxLogs) {
            logsContainer.lastChild.remove();
        }
        
        // Aplikujeme filtre na nov√© logy
        applyLogFilters();
        
        // Automatick√© skrolovanie k najnov≈°iemu logu (len ak je log viditeƒæn√Ω a nie je potlaƒçen√©)
        if (!desktopLogEntry.classList.contains('filtered') && !suppressAutoScroll) {
            desktopLogEntry.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
    };
    


    const openDeviceModal = (device = null) => {
        deviceForm.reset();
        document.getElementById('deviceId').value = device ? device.id : '';
        document.getElementById('deviceName').value = device ? device.name : '';
        document.getElementById('deviceIp').value = device ? device.ip : '';
        document.getElementById('deviceUsername').value = device ? device.username : ''; 
        document.getElementById('deviceSnmpCommunity').value = device ? (device.snmp_community || '') : '';
        document.getElementById('deviceSnmpInterval').value = device ? (device.snmp_interval_minutes || 0) : 0;
        document.getElementById('deviceLowMemory').checked = device ? device.low_memory : false;
        // Heslo sa nikdy neposiela sp√§≈• na frontend, tak≈æe ho nevypl≈àujeme
        document.getElementById('devicePassword').value = '';
        document.getElementById('devicePassword').required = !device; // Heslo je povinn√© len pre nov√© zariadenia
        
        // Dynamick√Ω placeholder text pre heslo
        const passwordField = document.getElementById('devicePassword');
        if (device) {
            passwordField.placeholder = '‚óè‚óè‚óè‚óè‚óè‚óè‚óè‚óè';
        } else {
            passwordField.placeholder = 'Zadajte heslo pre SSH pripojenie';
        }
        
        // Dynamick√Ω placeholder text pre SNMP Community
        const snmpCommunityField = document.getElementById('deviceSnmpCommunity');
        if (device && device.snmp_community) {
            snmpCommunityField.value = device.snmp_community;
            snmpCommunityField.placeholder = '';
        } else {
            snmpCommunityField.value = '';
            snmpCommunityField.placeholder = 'public';
        }
        
        deviceModal.classList.remove('hidden');
    };
    
    const openSettingsModal = async () => {
        const settings = await api.get('settings');
        Object.keys(settings).forEach(key => {
            const el = document.getElementById(key);
            if (el) el.type === 'checkbox' ? el.checked = (settings[key] === 'true') : el.value = settings[key];
        });
        Object.keys(notificationTypes).forEach(key => {
            const el = document.getElementById(key);
            if(el) el.checked = settings[key] === 'true';
        });
        toggleWeeklySettings();
        settingsModal.classList.remove('hidden');
    };

    const closeModal = () => {
        deviceModal.classList.add('hidden');
        settingsModal.classList.add('hidden');
        manageAccountModal.classList.add('hidden');
        snmpStatusModal.classList.add('hidden');
    };

    const loadDevices = async () => {
        try {
            const devices = await api.get('devices');
            if (!devices) return;
            devicesGrid.innerHTML = '';
            devices.forEach(device => devicesGrid.appendChild(createDeviceCard(device)));
            // Aktualizuj device filtre po naƒç√≠tan√≠ zariaden√≠
            await updateDeviceFilters();
        } catch (error) {
            console.error('Chyba pri naƒç√≠tan√≠ zariaden√≠:', error);
        }
    };

    const loadLogs = async () => {
        try {
            // Potlaƒç√≠me automatick√© skrolovanie poƒças naƒç√≠tavania logov
            suppressAutoScroll = true;
            
            // Prid√°me timeout pre API request
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 10000); // 10 sek√∫nd timeout
            
            const logs = await fetch(`${API_URL}/api/logs`, { 
                signal: controller.signal 
            }).then(res => {
                clearTimeout(timeoutId);
                return api._handleResponse(res);
            });
            
            if (!logs || !Array.isArray(logs)) {
                console.warn('Nepodarilo sa naƒç√≠ta≈• logy alebo neplatn√Ω form√°t');
                return;
            }
            
            // Vyƒçist√≠me existuj√∫ce logy
            logsContainer.innerHTML = '';
            const mobileLogsContainer = document.getElementById('logsContainerMobile');
            if (mobileLogsContainer) {
                mobileLogsContainer.innerHTML = '';
            }
            
            // Jednoducho prid√°me v≈°etky logy chronologicky (najnov≈°ie prv√©)
            const reversedLogs = logs.reverse();
            
            reversedLogs.forEach(log => {
                // Ignorujeme len startup spr√°vy
                if (!(log.message.includes('MikroTik Backup Manager') && log.message.includes('√∫spe≈°ne naƒç√≠tan√Ω!'))) {
                    addLogToContainer(log.level, log.message, log.device_ip, log.timestamp);
                }
            });
            
            // Po naƒç√≠tan√≠ logov aplikujeme aktu√°lne filtre
            applyLogFilters();
            
        } catch (error) {
            if (error.name === 'AbortError') {
                console.warn('Naƒç√≠tanie logov bolo preru≈°en√© kv√¥li timeout');
                addLogToContainer('warning', 'Naƒç√≠tanie logov trvalo pr√≠li≈° dlho a bolo preru≈°en√©', '', new Date().toISOString());
            } else {
                console.error('Chyba pri naƒç√≠tan√≠ logov:', error);
                addLogToContainer('error', 'Chyba pri naƒç√≠tan√≠ logov zo servera', '', new Date().toISOString());
            }
        } finally {
            // Obnov√≠me automatick√© skrolovanie po dokonƒçen√≠ naƒç√≠tavania (vr√°tane error stavov)
            suppressAutoScroll = false;
        }
    };

    const deleteDevice = async (id, ip) => {
        const confirmation = await showConfirmation(`Naozaj chcete odstr√°ni≈• zariadenie ${ip}?`);
        if (confirmation) {
            await api.delete(`devices/${id}`);
            loadDevices();
        }
    };
    
    const showConfirmation = (message) => {
        return new Promise((resolve) => {
            const confirmModal = document.createElement('div');
            confirmModal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50';
            confirmModal.innerHTML = `
                <div class="card p-8 rounded-lg w-full max-w-sm modal-content text-center">
                    <p class="text-lg mb-6">${message}</p>
                    <div class="flex justify-center gap-4">
                        <button class="btn-cancel btn bg-gray-600 hover:bg-gray-700 py-2 px-6 rounded-lg">Zru≈°i≈•</button>
                        <button class="btn-confirm btn btn-primary font-bold py-2 px-6 rounded-lg">Potvrdi≈•</button>
                    </div>
                </div>
            `;
            document.body.appendChild(confirmModal);
            confirmModal.querySelector('.btn-confirm').onclick = () => {
                resolve(true);
                document.body.removeChild(confirmModal);
            };
            confirmModal.querySelector('.btn-cancel').onclick = () => {
                resolve(false);
                document.body.removeChild(confirmModal);
            };
        });
    };

    const toggleWeeklySettings = () => {
        document.getElementById('weeklySettings').style.display = document.getElementById('backup_schedule_type').value === 'weekly' ? 'block' : 'none';
    };
    
    const populateNotificationTypes = () => {
        const container = document.getElementById('notificationTypes');
        container.innerHTML = Object.entries(notificationTypes).map(([key, label]) => `
            <div class="flex items-center">
                <input type="checkbox" id="${key}" name="${key}" class="h-4 w-4 rounded text-sky-500 focus:ring-sky-500">
                <label for="${key}" class="ml-2 text-sm">${label}</label>
            </div>`).join('');
    };
    
    // Funkcie pre filtrovanie logov
    const updateDeviceFilters = async () => {
        const devices = await api.get('devices');
        const deviceSelect = document.getElementById('deviceFilter');
        const deviceSelectMobile = document.getElementById('deviceFilterMobile');
        
        const options = '<option value="">V≈°etky zariadenia</option>' + 
            devices.map(device => `<option value="${device.ip}">${device.name} (${device.ip})</option>`).join('');
        
        deviceSelect.innerHTML = options;
        deviceSelectMobile.innerHTML = options;
    };
    
    const applyLogFilters = () => {
        const entries = document.querySelectorAll('.log-entry');
        
        entries.forEach(entry => {
            const deviceFilter = entry.getAttribute('data-device');
            const typeFilter = entry.getAttribute('data-type');
            const levelFilter = entry.getAttribute('data-level');
            const messageText = entry.textContent || '';
            
            let visible = true;
            
            // Filter by device - hƒæad√°me IP aj v data-device aj v texte spr√°vy
            if (currentFilters.device) {
                const deviceMatches = deviceFilter === currentFilters.device || 
                                    messageText.includes(currentFilters.device);
                if (!deviceMatches) {
                    visible = false;
                }
            }
            
            // Filter by type
            if (currentFilters.type && typeFilter !== currentFilters.type) {
                const msgLower = messageText.toLowerCase();
                
                // ≈†peci√°lne pravidlo: Pushover spr√°vy o online/offline stave s√∫ viditeƒæn√© aj v "status" filtri
                if (currentFilters.type === 'status' && typeFilter === 'notification') {
                    if (!(msgLower.includes('pushover') && (msgLower.includes('online') || msgLower.includes('offline')))) {
                        visible = false;
                    }
                } else {
                    visible = false;
                }
            }
            
            // Filter by level
            if (currentFilters.level !== 'all' && levelFilter !== currentFilters.level) {
                visible = false;
            }
            
            entry.classList.toggle('filtered', !visible);
        });
    };
    
    const setupLogFilters = () => {
        // Desktop filtre
        const deviceFilter = document.getElementById('deviceFilter');
        const typeFilter = document.getElementById('typeFilter');
        const levelButtons = document.querySelectorAll('.filter-level-btn');
        
        // Mobile filtre
        const deviceFilterMobile = document.getElementById('deviceFilterMobile');
        const typeFilterMobile = document.getElementById('typeFilterMobile');
        const levelButtonsMobile = document.querySelectorAll('.filter-level-btn-mobile');
        
        // Device filter events
        [deviceFilter, deviceFilterMobile].forEach(filter => {
            filter.addEventListener('change', (e) => {
                currentFilters.device = e.target.value;
                applyLogFilters();
                // Sync both selects
                deviceFilter.value = e.target.value;
                deviceFilterMobile.value = e.target.value;
            });
        });
        
        // Type filter events
        [typeFilter, typeFilterMobile].forEach(filter => {
            filter.addEventListener('change', (e) => {
                currentFilters.type = e.target.value;
                applyLogFilters();
                // Sync both selects
                typeFilter.value = e.target.value;
                typeFilterMobile.value = e.target.value;
            });
        });
        
        // Level filter events
        [...levelButtons, ...levelButtonsMobile].forEach(btn => {
            btn.addEventListener('click', (e) => {
                const level = e.target.id.replace('level', '').replace('Mobile', '').toLowerCase();
                currentFilters.level = level;
                
                // Update active states
                [...levelButtons, ...levelButtonsMobile].forEach(b => b.classList.remove('active'));
                document.querySelectorAll(`#level${level.charAt(0).toUpperCase() + level.slice(1)}, #level${level.charAt(0).toUpperCase() + level.slice(1)}Mobile`).forEach(b => b.classList.add('active'));
                
                applyLogFilters();
            });
        });
    };

    document.getElementById('addDeviceBtn').addEventListener('click', () => openDeviceModal());
    document.getElementById('settingsBtn').addEventListener('click', () => window.location.href = '/settings.html');
    document.getElementById('cancelDeviceBtn').addEventListener('click', closeModal);
    document.getElementById('cancelSettingsBtn').addEventListener('click', closeModal);
    document.getElementById('cancelAccountManageBtn').addEventListener('click', closeModal);
    document.getElementById('closeSnmpStatusBtn').addEventListener('click', closeModal);
    document.getElementById('refreshSnmpStatusBtn').addEventListener('click', async () => {
        const btn = document.getElementById('refreshSnmpStatusBtn');
        const icon = btn.querySelector('i');
        const contentDiv = document.getElementById('snmpStatusContent');
        
        // Anim√°cia len refresh tlaƒçidla - ≈æiadny overlay
        icon.classList.add('fa-spin');
        btn.disabled = true;
        
        try {
            const status = await api.get('snmp/status');
            
            // Vytvor√≠me obsah pre mod√°l (rovnak√Ω k√≥d ako v hlavnom event listeneri)
            let content = `
                <div class="bg-gray-800 p-4 rounded-lg mb-6 border border-gray-600">
                    <h3 class="text-lg font-semibold text-sky-400 mb-3">üìä Glob√°lne inform√°cie</h3>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div><strong>Glob√°lny interval:</strong> <span class="text-green-400">${status.global_interval} min√∫t</span></div>
                        <div><strong>ƒåas kontroly:</strong> <span class="text-gray-300">${new Date(status.current_time).toLocaleString('sk-SK')}</span></div>
                    </div>
                </div>
                
                <h3 class="text-lg font-semibold text-sky-400 mb-4">üîß Stav zariaden√≠</h3>
                <div class="grid gap-4">
            `;
            
            status.devices.forEach(device => {
                const intervalText = device.interval_setting > 0 
                    ? `${device.interval_setting} min (vlastn√Ω)` 
                    : `${status.global_interval} min (glob√°lny)`;
                const statusClass = device.is_due ? 'text-red-400' : 'text-green-400';
                const statusIcon = device.is_due ? 'üî¥' : 'üü¢';
                const statusText = device.is_due ? 'TREBA KONTROLA' : 'ƒåak√°';
                
                content += `
                    <div class="bg-gray-800 p-4 rounded-lg border border-gray-600">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="font-bold text-sky-300">${device.name}</h4>
                            <span class="font-mono text-sm text-gray-400">${device.ip}</span>
                        </div>
                        <div class="grid grid-cols-2 gap-3 text-sm">
                            <div><strong>Interval:</strong> <span class="text-gray-300">${intervalText}</span></div>
                            <div><strong>Posledn√° kontrola:</strong> <span class="text-gray-300">${device.last_check}</span></div>
                            <div><strong>ƒéal≈°ia kontrola:</strong> <span class="text-gray-300">${device.next_check}</span></div>
                            <div><strong>Stav:</strong> <span class="${statusClass}">${statusIcon} ${statusText}</span></div>
                        </div>
                    </div>
                `;
            });
            
            content += `</div>`;
            
            // Priamo nastav√≠me nov√Ω obsah mod√°lu - ≈æiadne fade efekty
            contentDiv.innerHTML = content;
            
        } catch (error) {
            // Zobraz√≠me chybu bez fade efektov
            contentDiv.innerHTML = `
                <div class="bg-red-900/20 border border-red-500 p-4 rounded-lg text-center">
                    <i class="fas fa-exclamation-triangle text-red-400 text-2xl mb-2"></i>
                    <p class="text-red-400 font-semibold">Chyba pri obnovovan√≠ SNMP stavu</p>
                    <p class="text-gray-400 text-sm mt-2">Sk√∫ste to znova alebo skontrolujte pripojenie k serveru.</p>
                </div>
            `;
        } finally {
            // Vr√°time tlaƒçidlo do norm√°lneho stavu
            icon.classList.remove('fa-spin');
            btn.disabled = false;
        }
    });
    document.getElementById('backupAllBtn').addEventListener('click', async () => {
        const btn = document.getElementById('backupAllBtn');
        const stopBtn = document.getElementById('stopAllBackupsBtn');
        const originalText = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sp√∫≈°≈•am...';
        btn.disabled = true;
        
        try {
            const result = await api.post('backup/all');
            if (result.status === 'success') {
                btn.innerHTML = '<i class="fas fa-clock"></i> Prebieha...';
                stopBtn.classList.remove('hidden'); // Zobraz√≠me stop tlaƒçidlo
                
                // Ka≈æd√Ωch 5 sek√∫nd kontrolujeme stav
                const checkStatus = setInterval(async () => {
                    const status = await api.get('backup/status');
                    if (status.total_running === 0 && !status.sequential_backup_running) {
                        clearInterval(checkStatus);
                        btn.innerHTML = originalText;
                        btn.disabled = false;
                        stopBtn.classList.add('hidden'); // Skryjeme stop tlaƒçidlo
                    } else {
                        btn.innerHTML = `<i class="fas fa-clock"></i> Prebieha (${status.total_running})`;
                    }
                }, 5000);
            } else {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        } catch (error) {
            btn.innerHTML = originalText;
            btn.disabled = false;
            stopBtn.classList.add('hidden');
        }
    });

    document.getElementById('stopAllBackupsBtn').addEventListener('click', async () => {
        const stopBtn = document.getElementById('stopAllBackupsBtn');
        const backupBtn = document.getElementById('backupAllBtn');
        
        stopBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Zastavujem...';
        stopBtn.disabled = true;
        
        try {
            const result = await api.post('backup/stop-all');
            addLog('warning', result.message || 'Z√°lohy boli zastaven√©.');
            
            // Skryjeme stop tlaƒçidlo a obnov√≠me backup tlaƒçidlo
            stopBtn.classList.add('hidden');
            backupBtn.innerHTML = '<i class="fas fa-save"></i> Z√°lohova≈• v≈°etky';
            backupBtn.disabled = false;
        } catch (error) {
            addLog('error', 'Chyba pri zastavovan√≠ z√°loh.');
        } finally {
            stopBtn.innerHTML = '<i class="fas fa-stop"></i> Zastavi≈• z√°lohy';
            stopBtn.disabled = false;
        }
    });
    document.getElementById('refreshAllSnmpBtn').addEventListener('click', async () => {
        // Skontrolujeme ƒçi u≈æ prebieha refresh
        if (isSnmpRefreshRunning) {
            return;
        }
        
        const btn = document.getElementById('refreshAllSnmpBtn');
        const icon = btn.querySelector('i');
        
        try {
            // Spust√≠me backend API pre hromadn√Ω refresh
            const response = await api.post('snmp/refresh-all');
            
            if (response.status === 'success') {
                // Backend API spustilo √∫lohu, progress bude riaden√Ω cez WebSocket
            } else {
                // Chyba zo servera
                console.error('Chyba pri spusten√≠ SNMP refresh:', response.message);
                addLog('error', response.message || 'Chyba pri spusten√≠ hromadn√©ho SNMP refresh');
            }
        } catch (error) {
            console.error('Chyba pri API volan√≠ pre SNMP refresh:', error);
            addLog('error', 'Chyba komunik√°cie so serverom pri SNMP refresh');
            
            // Pri chybe vr√°time tlaƒçidlo do norm√°lu
            icon.classList.remove('fa-spin');
            btn.disabled = false;
        }
    });
    document.getElementById('snmpStatusBtn').addEventListener('click', async () => {
        // Otvor√≠me mod√°l s loading stavom
        snmpStatusModal.classList.remove('hidden');
        document.getElementById('snmpStatusContent').innerHTML = `
            <div class="flex justify-center items-center py-8">
                <i class="fas fa-spinner fa-spin text-2xl text-sky-500 mr-3"></i>
                <span class="text-lg">Naƒç√≠tavam SNMP stav...</span>
            </div>
        `;
        
        try {
            const status = await api.get('snmp/status');
            
            // Vytvor√≠me obsah pre mod√°l
            let content = `
                <div class="bg-gray-800 p-4 rounded-lg mb-6 border border-gray-600">
                    <h3 class="text-lg font-semibold text-sky-400 mb-3">üìä Glob√°lne inform√°cie</h3>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div><strong>Glob√°lny interval:</strong> <span class="text-green-400">${status.global_interval} min√∫t</span></div>
                        <div><strong>ƒåas kontroly:</strong> <span class="text-gray-300">${new Date(status.current_time).toLocaleString('sk-SK')}</span></div>
                    </div>
                </div>
                
                <h3 class="text-lg font-semibold text-sky-400 mb-4">üîß Stav zariaden√≠</h3>
                <div class="grid gap-4">
            `;
            
            status.devices.forEach(device => {
                const intervalText = device.interval_setting > 0 
                    ? `${device.interval_setting} min (vlastn√Ω)` 
                    : `${status.global_interval} min (glob√°lny)`;
                const statusClass = device.is_due ? 'text-red-400' : 'text-green-400';
                const statusIcon = device.is_due ? 'üî¥' : 'üü¢';
                const statusText = device.is_due ? 'TREBA KONTROLA' : 'ƒåak√°';
                
                content += `
                    <div class="bg-gray-800 p-4 rounded-lg border border-gray-600">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="font-bold text-sky-300">${device.name}</h4>
                            <span class="font-mono text-sm text-gray-400">${device.ip}</span>
                        </div>
                        <div class="grid grid-cols-2 gap-3 text-sm">
                            <div><strong>Interval:</strong> <span class="text-gray-300">${intervalText}</span></div>
                            <div><strong>Posledn√° kontrola:</strong> <span class="text-gray-300">${device.last_check}</span></div>
                            <div><strong>ƒéal≈°ia kontrola:</strong> <span class="text-gray-300">${device.next_check}</span></div>
                            <div><strong>Stav:</strong> <span class="${statusClass}">${statusIcon} ${statusText}</span></div>
                        </div>
                    </div>
                `;
            });
            
            content += `</div>`;
            
            // Nastav√≠me obsah mod√°lu
            document.getElementById('snmpStatusContent').innerHTML = content;
            
        } catch (error) {
            document.getElementById('snmpStatusContent').innerHTML = `
                <div class="bg-red-900/20 border border-red-500 p-4 rounded-lg text-center">
                    <i class="fas fa-exclamation-triangle text-red-400 text-2xl mb-2"></i>
                    <p class="text-red-400 font-semibold">Chyba pri naƒç√≠tan√≠ SNMP stavu</p>
                    <p class="text-gray-400 text-sm mt-2">Sk√∫ste to znova alebo skontrolujte pripojenie k serveru.</p>
                </div>
            `;
        }
    });
    document.getElementById('monitoringBtn').addEventListener('click', () => {
        // Otvor√≠me monitoring str√°nku v aktu√°lnej z√°lo≈æke
        window.location.href = '/monitoring.html';
    });
    document.getElementById('backup_schedule_type').addEventListener('change', toggleWeeklySettings);
    document.getElementById('testPushoverBtn').addEventListener('click', () => api.post('notifications/test'));
    
    // Event listenery pre logy
    document.getElementById('refreshLogsBtn').addEventListener('click', async () => {
        const btn = document.getElementById('refreshLogsBtn');
        const icon = btn.querySelector('i');
        
        // Anim√°cia refresh tlaƒçidla
        icon.classList.add('fa-spin');
        btn.disabled = true;
        
        try {
            // Zavol√°me p√¥vodn√∫ loadLogs funkciu
            await loadLogs();
            
        } catch (error) {
            // P√¥vodn√° funkcionalita pre chyby
            addLog('error', 'Chyba pri obnovovan√≠ logov');
        } finally {
            // Vr√°time tlaƒçidlo do norm√°lneho stavu
            icon.classList.remove('fa-spin');
            btn.disabled = false;
        }
    });
    
    // Filter tlaƒçidl√° pre logy
    document.getElementById('logsFilterBtn').addEventListener('click', () => {
        const filters = document.getElementById('logsFilters');
        filters.classList.toggle('hidden');
    });
    
    document.getElementById('logsFilterBtnMobile').addEventListener('click', () => {
        const filters = document.getElementById('logsFiltersMobile');
        filters.classList.toggle('hidden');
    });

    // Event listenery pre mobiln√© tlaƒçidl√°
    document.getElementById('refreshLogsBtnMobile').addEventListener('click', () => {
        document.getElementById('refreshLogsBtn').click();
    });
    
    document.getElementById('exportLogsBtnMobile').addEventListener('click', () => {
        document.getElementById('exportLogsBtn').click();
    });
    
    // Export logov do CSV
    document.getElementById('exportLogsBtn').addEventListener('click', async () => {
        const btn = document.getElementById('exportLogsBtn');
        const icon = btn.querySelector('i');
        
        // Anim√°cia export tlaƒçidla
        icon.classList.add('fa-spin');
        btn.disabled = true;
        
        try {
            // Vytvor√≠me skryt√Ω link pre stiahnutie
            const link = document.createElement('a');
            link.href = '/api/logs/export';
            link.download = `mikrotik_logy_${new Date().toISOString().slice(0, 19).replace(/[T:]/g, '_')}.csv`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
        } catch (error) {
            addLog('error', 'Chyba pri exporte logov');
        } finally {
            // Vr√°time tlaƒçidlo do norm√°lneho stavu
            icon.classList.remove('fa-spin');
            btn.disabled = false;
        }
    });

    deviceForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const snmpCommunityValue = document.getElementById('deviceSnmpCommunity').value.trim();
        const body = {
            id: document.getElementById('deviceId').value,
            name: document.getElementById('deviceName').value,
            ip: document.getElementById('deviceIp').value,
            username: document.getElementById('deviceUsername').value,
            password: document.getElementById('devicePassword').value,
            snmp_community: snmpCommunityValue || 'public', // Ak je pr√°zdne, pou≈æije sa "public"
            snmp_interval_minutes: parseInt(document.getElementById('deviceSnmpInterval').value) || 0,
            low_memory: document.getElementById('deviceLowMemory').checked,
        };
        const result = await api.post('devices', body);
        closeModal();
        loadDevices();
        
        // Ak je to nov√© zariadenie (bez ID), automaticky spus≈• SNMP check
        if (!body.id && result.status === 'success' && result.device_id) {
            setTimeout(() => {
                api.get(`snmp/${result.device_id}`);
            }, 1000); // Kr√°tke oneskorenie pre naƒç√≠tanie zariadenia
        }
    });
    
    settingsForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const body = {};
        new FormData(settingsForm).forEach((value, key) => body[key] = value);
        settingsForm.querySelectorAll('input[type="checkbox"]').forEach(cb => body[cb.name] = cb.checked.toString());
        const result = await api.post('settings', body);
        
        // Aktualizujeme glob√°lne nastavenia pre frontend
        if (body.log_retention_days) {
            globalSettings.log_retention_days = parseInt(body.log_retention_days);
        }
        
        closeModal();
        
        // Spr√°va "Nastavenia boli ulo≈æen√©." sa u≈æ odosiela zo servera
        // addLog('success', 'Nastavenia boli ulo≈æen√©.');
    });

    // === Account Management Tabs ===
    const accountTabs = document.querySelectorAll('.account-tab');
    const tabContents = document.querySelectorAll('.tab-content');
    
    accountTabs.forEach(tab => {
        tab.addEventListener('click', () => {
            // Remove active class from all tabs
            accountTabs.forEach(t => {
                t.classList.remove('active');
                t.classList.remove('text-sky-400', 'border-sky-400');
                t.classList.add('text-gray-400', 'border-transparent');
            });
            
            // Add active class to clicked tab
            tab.classList.add('active');
            tab.classList.remove('text-gray-400', 'border-transparent');
            tab.classList.add('text-sky-400', 'border-sky-400');
            
            // Hide all tab contents
            tabContents.forEach(content => content.classList.add('hidden'));
            
            // Show corresponding content
            const tabId = tab.id.replace('tab', 'tab') + 'Content';
            document.getElementById(tabId).classList.remove('hidden');
            
            // Load 2FA status only when 2FA tab is clicked
            if (tab.id === 'tab2FA') {
                load2faStatus();
            }
            
            // Clear any previous messages when switching tabs
            const messageDiv = document.getElementById('accountManageMessage');
            messageDiv.classList.add('hidden');
        });
    });

    // === Password Toggle Functionality - ONLY for Password Tab ===
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('password-toggle') && 
            e.target.closest('#tabPasswordContent')) {
            const targetId = e.target.getAttribute('data-target');
            const passwordInput = document.getElementById(targetId);
            const toggleIcon = e.target;
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleIcon.classList.remove('fa-eye');
                toggleIcon.classList.add('fa-eye-slash');
            } else {
                passwordInput.type = 'password';
                toggleIcon.classList.remove('fa-eye-slash');
                toggleIcon.classList.add('fa-eye');
            }
        }
    });

    // === Form Handlers ===
    changePasswordForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const messageDiv = document.getElementById('accountManageMessage');
        
        const body = {
            old_password: document.getElementById('oldPassword').value,
            new_password: document.getElementById('newPassword').value,
            new_password_confirm: document.getElementById('newPasswordConfirm').value,
        };
        
        try {
            const result = await api.post('user/change-password', body);
            
            messageDiv.textContent = result.message;
            messageDiv.classList.remove('hidden', 'bg-green-900/50', 'text-green-300', 'bg-red-900/50', 'text-red-300');
            if (result.status === 'success') {
                messageDiv.classList.add('bg-green-900/50', 'text-green-300');
                changePasswordForm.reset();
                setTimeout(() => {
                    closeModal();
                    messageDiv.classList.add('hidden');
                }, 2000);
            } else {
                messageDiv.classList.add('bg-red-900/50', 'text-red-300');
            }
        } catch (error) {
            console.error('Password change error:', error);
            messageDiv.textContent = 'Nastala chyba pri zmene hesla.';
            messageDiv.classList.remove('hidden', 'bg-green-900/50', 'text-green-300', 'bg-red-900/50', 'text-red-300');
            messageDiv.classList.add('bg-red-900/50', 'text-red-300');
        }
    });

    changeUsernameForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const messageDiv = document.getElementById('accountManageMessage');
        const body = {
            new_username: document.getElementById('newUsername').value,
            password: document.getElementById('confirmPasswordUsername').value,
        };
        
        try {
            const result = await api.post('user/change-username', body);
            
            messageDiv.textContent = result.message;
            messageDiv.classList.remove('hidden', 'bg-green-900/50', 'text-green-300', 'bg-red-900/50', 'text-red-300');
            if (result.status === 'success') {
                messageDiv.classList.add('bg-green-900/50', 'text-green-300');
                changeUsernameForm.reset();
                setTimeout(() => {
                    closeModal();
                    messageDiv.classList.add('hidden');
                    // Refresh user status to show updated username
                    loadUserStatus();
                }, 2000);
            } else {
                messageDiv.classList.add('bg-red-900/50', 'text-red-300');
            }
        } catch (error) {
            console.error('Username change error:', error);
            messageDiv.textContent = 'Nastala chyba pri zmene pou≈æ√≠vateƒæsk√©ho mena.';
            messageDiv.classList.remove('hidden', 'bg-green-900/50', 'text-green-300', 'bg-red-900/50', 'text-red-300');
            messageDiv.classList.add('bg-red-900/50', 'text-red-300');
        }
    });

    // === 2FA Management Functions ===
    
    // Load 2FA status
    const load2faStatus = async () => {
        try {
            const data = await api.get('user/backup-codes');
            
            if (data && typeof data.remaining_codes !== 'undefined') {
                const remainingCodes = data.remaining_codes || 0;
                const remainingCodesElement = document.getElementById('remainingCodes');
                if (remainingCodesElement) {
                    remainingCodesElement.textContent = remainingCodes;
                }
            }
            
        } catch (error) {
            console.error('Chyba pri naƒç√≠tavan√≠ 2FA stavu:', error);
            
            // Ak nie je 2FA aktivovan√©, jednoducho nezobraz√≠me niƒç
            if (error.message.includes('403') || error.message.includes('2FA nie je aktivovan√©')) {
                const remainingCodesElement = document.getElementById('remainingCodes');
                if (remainingCodesElement) {
                    remainingCodesElement.textContent = '2FA nie je aktivovan√©';
                }
            }
        }
    };
    
    // Generate backup codes
    const generateBackupCodes = async (password) => {
        const messageDiv = document.getElementById('confirmPasswordMessage');
        
        try {
            // Skryje predch√°dzaj√∫ce chybov√© spr√°vy
            messageDiv.classList.add('hidden');
            
            const data = await api.post('user/backup-codes', { password });
            
            if (data && data.status === 'success' && data.backup_codes) {
                displayBackupCodes(data.backup_codes);
                confirmPasswordModal.classList.add('hidden');
                backupCodesModal.classList.remove('hidden');
                return true;
            } else {
                throw new Error(data?.message || 'Neplatn√° odpoveƒè zo servera');
            }
        } catch (error) {
            console.error('Chyba pri generovan√≠ z√°lo≈æn√Ωch k√≥dov:', error);
            
            let errorMessage = 'Chyba pri generovan√≠ z√°lo≈æn√Ωch k√≥dov';
            
            if (error.message.includes('401') || error.message.includes('Unauthorized')) {
                errorMessage = 'Nespr√°vne heslo';
            } else if (error.message.includes('403') || error.message.includes('Forbidden')) {
                errorMessage = 'Nem√°te opr√°vnenie na t√∫to oper√°ciu';
            } else if (error.message.includes('500')) {
                errorMessage = 'Chyba servera. Sk√∫ste to znova nesk√¥r.';
            } else if (error.message) {
                errorMessage = error.message;
            }
            
            messageDiv.textContent = errorMessage;
            messageDiv.classList.remove('hidden', 'bg-green-900/50', 'text-green-300', 'bg-red-900/50', 'text-red-300');
            messageDiv.classList.add('bg-red-900/50', 'text-red-300');
            return false;
        }
    };
    
    // Display backup codes
    const displayBackupCodes = (codes) => {
        const container = document.getElementById('backupCodesDisplay');
        container.innerHTML = '';
        
        codes.forEach(code => {
            const codeDiv = document.createElement('div');
            codeDiv.className = 'bg-gray-800 p-2 rounded text-center text-gray-200';
            codeDiv.textContent = code;
            container.appendChild(codeDiv);
        });
    };
    
    // Download backup codes as file
    const downloadBackupCodes = () => {
        const codes = Array.from(document.getElementById('backupCodesDisplay').children)
            .map(div => div.textContent)
            .join('\n');
        
        const blob = new Blob([
            `MikroTik Manager - Z√°lo≈æn√© k√≥dy pre 2FA\n` +
            `Vygenerovan√©: ${new Date().toLocaleString('sk-SK')}\n\n` +
            `D√îLE≈ΩIT√â:\n` +
            `- Ka≈æd√Ω k√≥d mo≈æno pou≈æi≈• iba jedenkr√°t\n` +
            `- Ulo≈æte si tieto k√≥dy na bezpeƒçn√© miesto\n` +
            `- Nikomu ich neposkytujte\n\n` +
            `Z√°lo≈æn√© k√≥dy:\n${codes}`
        ], { type: 'text/plain' });
        
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `mikrotik-backup-codes-${new Date().toISOString().split('T')[0]}.txt`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    };
    
    // Print backup codes
    const printBackupCodes = () => {
        const codes = Array.from(document.getElementById('backupCodesDisplay').children)
            .map(div => div.textContent);
        
        const printWindow = window.open('', '_blank');
        printWindow.document.write(`
            <html>
                <head>
                    <title>MikroTik Manager - Z√°lo≈æn√© k√≥dy</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .header { text-align: center; margin-bottom: 30px; }
                        .warning { background-color: #fee; border: 1px solid #fcc; padding: 15px; margin: 20px 0; border-radius: 5px; }
                        .codes { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin: 20px 0; }
                        .code { background-color: #f9f9f9; padding: 10px; text-align: center; font-family: monospace; font-size: 14px; border: 1px solid #ddd; border-radius: 3px; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>MikroTik Manager</h1>
                        <h2>Z√°lo≈æn√© k√≥dy pre dvojfaktorov√© overenie</h2>
                        <p>Vygenerovan√©: ${new Date().toLocaleString('sk-SK')}</p>
                    </div>
                    <div class="warning">
                        <h3>‚ö†Ô∏è D√îLE≈ΩIT√â UPOZORNENIE</h3>
                        <ul>
                            <li>Ka≈æd√Ω k√≥d mo≈æno pou≈æi≈• iba jedenkr√°t</li>
                            <li>Ulo≈æte si tieto k√≥dy na bezpeƒçn√© miesto</li>
                            <li>Nikomu ich neposkytujte</li>
                            <li>Po pou≈æit√≠ k√≥du ho vy≈°krtnite zo zoznamu</li>
                        </ul>
                    </div>
                    <div class="codes">
                        ${codes.map(code => `<div class="code">${code}</div>`).join('')}
                    </div>
                </body>
            </html>
        `);
        printWindow.document.close();
        printWindow.print();
    };
    
    // Event listeners for 2FA functionality
    document.getElementById('generateBackupCodesBtn').addEventListener('click', () => {
        manageAccountModal.classList.add('hidden');
        confirmPasswordModal.classList.remove('hidden');
        document.getElementById('confirmPasswordInput').focus();
    });
    
    document.getElementById('cancelConfirmPasswordBtn').addEventListener('click', () => {
        confirmPasswordModal.classList.add('hidden');
        manageAccountModal.classList.remove('hidden');
        document.getElementById('confirmPasswordForm').reset();
        document.getElementById('confirmPasswordMessage').classList.add('hidden');
    });
    
    document.getElementById('confirmPasswordForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const password = document.getElementById('confirmPasswordInput').value;
        const submitBtn = e.target.querySelector('button[type="submit"]');
        const originalText = submitBtn.innerHTML;
        
        // Disable button and show loading
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Generujem...';
        
        try {
            await generateBackupCodes(password);
        } finally {
            // Restore button state
            submitBtn.disabled = false;
            submitBtn.innerHTML = originalText;
        }
    });
    
    document.getElementById('closeBackupCodesBtn').addEventListener('click', () => {
        backupCodesModal.classList.add('hidden');
        manageAccountModal.classList.remove('hidden');
        
        // Automatically switch to 2FA tab
        const accountTabs = document.querySelectorAll('.account-tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const tab2FA = document.getElementById('tab2FA');
        
        // Remove active class from all tabs
        accountTabs.forEach(t => {
            t.classList.remove('active');
            t.classList.remove('text-sky-400', 'border-sky-400');
            t.classList.add('text-gray-400', 'border-transparent');
        });
        
        // Add active class to 2FA tab
        tab2FA.classList.add('active');
        tab2FA.classList.remove('text-gray-400', 'border-transparent');
        tab2FA.classList.add('text-sky-400', 'border-sky-400');
        
        // Hide all tab contents
        tabContents.forEach(content => content.classList.add('hidden'));
        
        // Show 2FA tab content
        document.getElementById('tab2FAContent').classList.remove('hidden');
        
        // Refresh the status
        load2faStatus();
        
        document.getElementById('confirmPasswordForm').reset();
        document.getElementById('confirmPasswordMessage').classList.add('hidden');
    });
    
    document.getElementById('downloadCodesBtn').addEventListener('click', downloadBackupCodes);
    document.getElementById('printCodesBtn').addEventListener('click', printBackupCodes);
    
    // Close modals when clicking outside
    [confirmPasswordModal, backupCodesModal].forEach(modal => {
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.classList.add('hidden');
                manageAccountModal.classList.remove('hidden');
            }
        });
    });

    // Inicializ√°cia aplik√°cie
    const initializeApp = async () => {
        try {
            // Naƒç√≠tame glob√°lne nastavenia pre frontend limity
            try {
                const settings = await api.get('settings');
                if (settings && settings.log_retention_days) {
                    globalSettings.log_retention_days = parseInt(settings.log_retention_days);
                }
            } catch (error) {
                console.warn('Nepodarilo sa naƒç√≠ta≈• nastavenia, pou≈æ√≠vam predvolen√© hodnoty');
            }
            
            // Naƒç√≠tavame postupne, nie v≈°etko naraz
            await loadUserStatus();
            populateNotificationTypes();
            setupLogFilters();
            
            // Mal√© oneskorenie medzi oper√°ciami
            await new Promise(resolve => setTimeout(resolve, 100));
            await updateDeviceFilters();
            
            await new Promise(resolve => setTimeout(resolve, 100));
            await loadDevices();
            
            await new Promise(resolve => setTimeout(resolve, 100));
            
            // Naƒç√≠tanie logov bez startup spr√°vy
            await loadLogs();
            
            // Skontrolujeme stav SNMP refresh na backend-e
            setTimeout(async () => {
                try {
                    const refreshStatus = await api.get('snmp/refresh-all/status');
                    if (refreshStatus.is_running) {
                        // Ak prebieha refresh, aktualizujeme UI
                        updateSnmpRefreshButton('processing', 
                            refreshStatus.progress.current, 
                            refreshStatus.progress.total);
                        isSnmpRefreshRunning = true;
                    }
                } catch (error) {
                    console.warn('Nepodarilo sa naƒç√≠ta≈• stav SNMP refresh:', error);
                }
            }, 500); // Mal√© oneskorenie aby sa v≈°etko stihlo naƒç√≠ta≈•
        } catch (error) {
            console.error('Chyba pri inicializ√°cii aplik√°cie:', error);
            addLogToContainer('error', 'Chyba pri inicializ√°cii aplik√°cie', '', new Date().toISOString());
        }
    };
    
    // Spustenie inicializ√°cie
    initializeApp();

    // Po naƒç√≠tan√≠ str√°nky automaticky obnov SNMP pre v≈°etky zariadenia - postupne
    window.addEventListener('DOMContentLoaded', function() {
        // Dlh≈°ie oneskorenie pred SNMP refresh, aby sa backend stiahol stabilizova≈•
        setTimeout(() => {
            fetch('/api/devices')
                .then(resp => resp.json())
                .then(devices => {
                    // Ak je m√°lo zariaden√≠, nerob√≠me automatick√Ω refresh
                    if (devices.length <= 2) {
                        return;
                    }
                    
                    // SNMP refresh len pre prv√© 3 zariadenia s dlh≈°√≠m oneskoren√≠m
                    const limitedDevices = devices.slice(0, 3);
                    limitedDevices.forEach((device, index) => {
                        setTimeout(() => {
                            fetch(`/api/snmp/${device.id}`)
                                .then(() => {/* SNMP refresh prebehol */})
                                .catch(() => {/* Ignoruj chyby */});
                        }, index * 3000); // 3 sekundy medzi requestmi
                    });
                })
                .catch(error => console.error('Chyba pri automatickom SNMP refresh:', error));
        }, 5000); // Zv√Ω≈°en√© na 5 sek√∫nd po naƒç√≠tan√≠ aplik√°cie
    });
    
    // Funkcie pre prep√≠nanie t√©my
    function initTheme() {
        const savedTheme = localStorage.getItem('mikrotik-theme') || 'dark';
        document.body.className = savedTheme === 'light' ? 'light-theme p-4 md:p-8' : 'p-4 md:p-8';
        updateThemeIcon();
    }
    
    function toggleTheme() {
        const isLight = document.body.classList.contains('light-theme');
        if (isLight) {
            document.body.className = 'p-4 md:p-8';
            localStorage.setItem('mikrotik-theme', 'dark');
        } else {
            document.body.className = 'light-theme p-4 md:p-8';
            localStorage.setItem('mikrotik-theme', 'light');
        }
        updateThemeIcon();
    }
    
    function updateThemeIcon() {
        const icon = document.getElementById('theme-icon');
        const isLight = document.body.classList.contains('light-theme');
        icon.className = isLight ? 'fas fa-moon' : 'fas fa-sun';
    }
    
    // Inicializ√°cia t√©my pri naƒç√≠tan√≠ str√°nky
    initTheme();
    
    // Event listener pre prep√≠naƒç t√©my
    document.getElementById('themeToggleBtn').addEventListener('click', toggleTheme);
});
</script>

<!-- Debug Panel -->
<div id="debugPanel" class="debug-panel">
    <div class="debug-panel-header">
        <div class="debug-panel-title">
            <i class="fas fa-bug"></i>
            Debug Logs
        </div>
        <div class="debug-panel-controls">
            <button id="debugClearBtn" class="debug-panel-btn" title="Vymaza≈• logy">
                <i class="fas fa-trash"></i>
            </button>
            <button id="debugCopyBtn" class="debug-panel-btn" title="Kop√≠rova≈• v≈°etky logy">
                <i class="fas fa-copy"></i>
            </button>
            <button id="debugMinimizeBtn" class="debug-panel-btn" title="Minimalizova≈•">
                <i class="fas fa-minus"></i>
            </button>
            <button id="debugCloseBtn" class="debug-panel-btn" title="Zavrie≈•">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>
    <div id="debugPanelContent" class="debug-panel-content">
        <!-- Debug logs will be inserted here -->
    </div>
</div>

<script>
// Debug Panel Implementation for index.html
let debugSettings = {};
let debugPanelLogs = [];
let debugPanelVisible = false;

// Load debug settings
const loadDebugSettings = async () => {
    try {
        const response = await fetch('/api/settings');
        const settings = await response.json();
        debugSettings = settings;
        
        // Show debug panel automatically if enabled in settings
        const showDebugPanel = settings.debug_chart_frontend_panel === 'true' || settings.debug_master_switch === 'true';
        
        if (showDebugPanel && !debugPanelVisible) {
            document.getElementById('debugPanel').classList.add('visible');
            debugPanelVisible = true;
        } else if (!showDebugPanel && debugPanelVisible) {
            document.getElementById('debugPanel').classList.remove('visible');
            debugPanelVisible = false;
        }
    } catch (error) {
        console.error('Failed to load debug settings:', error);
    }
};

// Debug logging function
function debugLog(debugType, message, ...args) {
    // Check if any debug is enabled
    if (debugSettings[debugType] !== 'true' && debugSettings['debug_master_switch'] !== 'true') {
        return;
    }
    
    // Only log to console if explicitly enabled (no automatic console logging)
    // console.log(`[${debugType.toUpperCase()}]`, message, ...args);
    
    // If debug panel is enabled, log to panel
    if (debugSettings.debug_chart_frontend_panel === 'true' || debugSettings.debug_master_switch === 'true') {
        addLogToPanel(debugType, message, args);
    }
}

// Add log to debug panel
function addLogToPanel(debugType, message, args) {
    const timestamp = new Date().toLocaleTimeString();
    const logEntry = {
        timestamp,
        type: debugType,
        message,
        args: args.length > 0 ? args : null
    };
    
    debugPanelLogs.push(logEntry);
    
    // Limit to last 100 logs
    if (debugPanelLogs.length > 100) {
        debugPanelLogs.shift();
    }
    
    updateDebugPanelContent();
}

// Update debug panel content
function updateDebugPanelContent() {
    const content = document.getElementById('debugPanelContent');
    if (!content) return;
    
    content.innerHTML = debugPanelLogs.map(log => {
        const argsHtml = log.args ? `<div class="debug-args">${JSON.stringify(log.args, null, 2)}</div>` : '';
        return `
            <div class="debug-log-entry ${log.type}">
                <span class="debug-timestamp">${log.timestamp}</span>
                <span class="debug-type">[${log.type.toUpperCase()}]</span>
                <span class="debug-message">${log.message}</span>
                ${argsHtml}
            </div>
        `;
    }).join('');
    
    // Auto scroll to bottom
    content.scrollTop = content.scrollHeight;
}

// Debug panel controls
document.addEventListener('DOMContentLoaded', function() {
    loadDebugSettings();
    
    // Check for debug settings changes when user returns to page
    window.addEventListener('focus', function() {
        if (!window._lastDebugCheck || Date.now() - window._lastDebugCheck > 5000) {
            loadDebugSettings();
            window._lastDebugCheck = Date.now();
        }
    });
    
    // Debug panel controls
    document.getElementById('debugClearBtn')?.addEventListener('click', function() {
        debugPanelLogs = [];
        updateDebugPanelContent();
        debugLog('debug_device_operations', 'Debug panel cleared');
    });
    
    document.getElementById('debugCopyBtn')?.addEventListener('click', function() {
        const logsText = debugPanelLogs.map(log => {
            const argsText = log.args ? ` | ${JSON.stringify(log.args)}` : '';
            return `${log.timestamp} [${log.type.toUpperCase()}] ${log.message}${argsText}`;
        }).join('\n');
        
        navigator.clipboard.writeText(logsText).then(() => {
            debugLog('debug_device_operations', 'Debug logs copied to clipboard');
        });
    });
    
    document.getElementById('debugMinimizeBtn')?.addEventListener('click', function() {
        const panel = document.getElementById('debugPanel');
        const content = panel.querySelector('.debug-panel-content');
        const isMinimized = panel.style.height === '40px';
        
        if (isMinimized) {
            panel.style.height = '';
            content.style.display = 'flex';
        } else {
            panel.style.height = '40px';
            content.style.display = 'none';
        }
    });
    
    document.getElementById('debugCloseBtn')?.addEventListener('click', function() {
        document.getElementById('debugPanel').classList.remove('visible');
        debugPanelVisible = false;
    });
    
    // Keyboard shortcut Ctrl+D - only works if debug panel is enabled
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'd') {
            e.preventDefault();
            const showDebugPanel = debugSettings.debug_chart_frontend_panel === 'true' || debugSettings.debug_master_switch === 'true';
            if (showDebugPanel) {
                const panel = document.getElementById('debugPanel');
                if (debugPanelVisible) {
                    panel.classList.remove('visible');
                    debugPanelVisible = false;
                } else {
                    panel.classList.add('visible');
                    debugPanelVisible = true;
                }
            }
        }
    });
});

// Export debugLog to window scope for use in other scripts
window.debugLog = debugLog;
</script>

</body>
</html>